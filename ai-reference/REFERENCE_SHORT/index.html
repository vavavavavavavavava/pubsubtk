
<!doctype html>
<html lang="ja" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="イベント駆動＆状態管理型Python GUIライブラリ">
      
      
      
        <link rel="canonical" href="https://vavavavavavavavava.github.io/pubsubtk/ai-reference/REFERENCE_SHORT/">
      
      
        <link rel="prev" href="../REFERENCE_FULL/">
      
      
        <link rel="next" href="../../dev/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>REFERENCE_SHORT - PubSubTk Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pubsubtk-" class="md-skip">
          コンテンツにスキップ
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="ヘッダー">
    <a href="../.." title="PubSubTk Documentation" class="md-header__button md-logo" aria-label="PubSubTk Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PubSubTk Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              REFERENCE_SHORT
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="ダークモードに切り替え"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="ダークモードに切り替え" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="ライトモードに切り替え"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="ライトモードに切り替え" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="検索" placeholder="検索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="検索">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="共有" aria-label="共有" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="クリア" aria-label="クリア" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            検索を初期化
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/vavavavavavavavava/pubsubtk" title="リポジトリへ" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    vavavavavavavavava/pubsubtk
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="タブ" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  トップ

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../getting-started/" class="md-tabs__link">
        
  
  
    
  
  はじめに

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../cookbook/" class="md-tabs__link">
        
  
  
    
  
  実装レシピ集

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../examples/" class="md-tabs__link">
        
  
  
    
  
  サンプル集

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../storybook-guide/" class="md-tabs__link">
        
  
  
    
  
  Storybookガイド

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../faq/" class="md-tabs__link">
        
  
  
    
  
  FAQ

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../api/" class="md-tabs__link">
          
  
  
  リファレンス

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../dev/" class="md-tabs__link">
        
  
  
    
  
  開発者向け

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="ナビゲーション" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="PubSubTk Documentation" class="md-nav__button md-logo" aria-label="PubSubTk Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    PubSubTk Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/vavavavavavavavava/pubsubtk" title="リポジトリへ" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    vavavavavavavavava/pubsubtk
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    トップ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    はじめに
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cookbook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    実装レシピ集
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    サンプル集
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storybook-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storybookガイド
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    リファレンス
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            リファレンス
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API概要
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API詳細
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            API詳細
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2_1" >
        
          
          <label class="md-nav__link" for="__nav_7_2_1" id="__nav_7_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pubsubtk
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_1">
            <span class="md-nav__icon md-icon"></span>
            Pubsubtk
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2_1_1" >
        
          
          <label class="md-nav__link" for="__nav_7_2_1_1" id="__nav_7_2_1_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    App
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_2_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_1_1">
            <span class="md-nav__icon md-icon"></span>
            App
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/app/application_base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.app.application_base
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2_1_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2_1_2" id="__nav_7_2_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_2_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_1_2">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/core/default_topic_base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.core.default_topic_base
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/core/pubsub_base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.core.pubsub_base
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2_1_3" >
        
          
          <label class="md-nav__link" for="__nav_7_2_1_3" id="__nav_7_2_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Processor
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_2_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_1_3">
            <span class="md-nav__icon md-icon"></span>
            Processor
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/processor/processor_base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.processor.processor_base
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2_1_4" >
        
          
          <label class="md-nav__link" for="__nav_7_2_1_4" id="__nav_7_2_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Store
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_2_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_1_4">
            <span class="md-nav__icon md-icon"></span>
            Store
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/store/store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.store.store
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2_1_5" >
        
          
          <label class="md-nav__link" for="__nav_7_2_1_5" id="__nav_7_2_1_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Storybook
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_2_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_1_5">
            <span class="md-nav__icon md-icon"></span>
            Storybook
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/storybook/app/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.storybook.app
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2_1_5_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2_1_5_2" id="__nav_7_2_1_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_7_2_1_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_1_5_2">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/storybook/core/auto_discover/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.storybook.core.auto_discover
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/storybook/core/context/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.storybook.core.context
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/storybook/core/decorator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.storybook.core.decorator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/storybook/core/meta/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.storybook.core.meta
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/storybook/core/registry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.storybook.core.registry
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/storybook/core/state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.storybook.core.state
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2_1_5_3" >
        
          
          <label class="md-nav__link" for="__nav_7_2_1_5_3" id="__nav_7_2_1_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Knobs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_7_2_1_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_1_5_3">
            <span class="md-nav__icon md-icon"></span>
            Knobs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/storybook/knobs/controls/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.storybook.knobs.controls
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/storybook/knobs/panel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.storybook.knobs.panel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/storybook/knobs/store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.storybook.knobs.store
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/storybook/knobs/types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.storybook.knobs.types
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2_1_5_4" >
        
          
          <label class="md-nav__link" for="__nav_7_2_1_5_4" id="__nav_7_2_1_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Processors
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_7_2_1_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_1_5_4">
            <span class="md-nav__icon md-icon"></span>
            Processors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/storybook/processors/processor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.storybook.processors.processor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/storybook/processors/topics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.storybook.processors.topics
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2_1_5_5" >
        
          
          <label class="md-nav__link" for="__nav_7_2_1_5_5" id="__nav_7_2_1_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ui
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_7_2_1_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_1_5_5">
            <span class="md-nav__icon md-icon"></span>
            Ui
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/storybook/ui/container/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.storybook.ui.container
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/storybook/ui/preview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.storybook.ui.preview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/storybook/ui/sidebar/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.storybook.ui.sidebar
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/storybook/ui/template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.storybook.ui.template
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2_1_6" >
        
          
          <label class="md-nav__link" for="__nav_7_2_1_6" id="__nav_7_2_1_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Topic
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_2_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_1_6">
            <span class="md-nav__icon md-icon"></span>
            Topic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/topic/topics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.topic.topics
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2_1_7" >
        
          
          <label class="md-nav__link" for="__nav_7_2_1_7" id="__nav_7_2_1_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ui
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_2_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_1_7">
            <span class="md-nav__icon md-icon"></span>
            Ui
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/ui/types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.ui.types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2_1_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2_1_7_2" id="__nav_7_2_1_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Base
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_7_2_1_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_1_7_2">
            <span class="md-nav__icon md-icon"></span>
            Base
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/ui/base/container_base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.ui.base.container_base
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/ui/base/presentational_base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.ui.base.presentational_base
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/ui/base/template_base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.ui.base.template_base
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2_1_8" >
        
          
          <label class="md-nav__link" for="__nav_7_2_1_8" id="__nav_7_2_1_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_2_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_1_8">
            <span class="md-nav__icon md-icon"></span>
            Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pubsubtk/utils/async_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pubsubtk.utils.async_utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" checked>
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    AIリファレンス（AIコーディング支援用）
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            AIリファレンス（AIコーディング支援用）
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../REFERENCE_FULL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    REFERENCE_FULL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    REFERENCE_SHORT
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    REFERENCE_SHORT
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目次">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目次
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      主な特徴
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      アーキテクチャ概要
    </span>
  </a>
  
    <nav class="md-nav" aria-label="アーキテクチャ概要">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      構造イメージ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      各コンポーネントの役割
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      🎯 推奨インポートパターン
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      主要メソッド一覧
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      開発のポイント
    </span>
  </a>
  
    <nav class="md-nav" aria-label="開発のポイント">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stateproxyide" class="md-nav__link">
    <span class="md-ellipsis">
      StateProxyによるIDE連携
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      コンポーネント設計指針
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#undoredo" class="md-nav__link">
    <span class="md-ellipsis">
      Undo/Redo 機能
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pubsub" class="md-nav__link">
    <span class="md-ellipsis">
      カスタムトピック・PubSub拡張
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      よくある問題と解決法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      実践例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="実践例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      全機能を活用したシンプルなカウンターアプリ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dev/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    開発者向け
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目次">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目次
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      主な特徴
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      アーキテクチャ概要
    </span>
  </a>
  
    <nav class="md-nav" aria-label="アーキテクチャ概要">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      構造イメージ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      各コンポーネントの役割
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      🎯 推奨インポートパターン
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      主要メソッド一覧
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      開発のポイント
    </span>
  </a>
  
    <nav class="md-nav" aria-label="開発のポイント">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stateproxyide" class="md-nav__link">
    <span class="md-ellipsis">
      StateProxyによるIDE連携
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      コンポーネント設計指針
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#undoredo" class="md-nav__link">
    <span class="md-ellipsis">
      Undo/Redo 機能
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pubsub" class="md-nav__link">
    <span class="md-ellipsis">
      カスタムトピック・PubSub拡張
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      よくある問題と解決法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      実践例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="実践例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      全機能を活用したシンプルなカウンターアプリ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<p><a href="https://github.com/vavavavavavavavava/pubsubtk/blob/main/docs/ai-reference/REFERENCE_SHORT.md" target="_blank" style="display:inline-block;background:#2962ff;color:#fff;border:none;border-radius:1.2em;box-shadow:0 2px 8px rgba(0,0,0,0.15);padding:0.7em 1.6em;font-size:1em;font-weight:bold;text-decoration:none;margin:1em 0;">このページのMarkdownを見る</a></p>
<hr />
<h1 id="pubsubtk-">PubSubTk ライブラリ - リファレンスガイド<a class="headerlink" href="#pubsubtk-" title="Permanent link">&para;</a></h1>
<h2 id="_1">概要<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>PubSubTk は、Pydantic を用いた型安全な状態管理と、Publish-Subscribe パターンを組み合わせて、Tkinter/ttk を使った GUI アプリケーションをシンプルに構築できる Python ライブラリです。</p>
<h2 id="_2">主な特徴<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>UIとビジネスロジックの疎結合</strong> ― Publish/Subscribe（Pub/Sub）で部品間を非同期メッセージ連携</li>
<li><strong>Pydanticモデル</strong> による型安全な状態管理。バリデーションや JSON Schema 出力も簡単</li>
<li><strong>Container / Presentational / Processor</strong> 3層分離パターンを標準化（Reactスタイルの設計をTkinterでも）</li>
<li><strong>Pub/Subによる画面遷移・サブウィンドウ管理</strong>と<strong>リアクティブUI更新</strong>をサポート</li>
<li>依存は純正Pythonのみ（<code>tkinter</code>, <code>pypubsub</code>, <code>pydantic</code>）。Tkテーマ変更用に <code>ttkthemes</code> も利用可能</li>
</ul>
<hr />
<h2 id="_3">アーキテクチャ概要<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="_4">構造イメージ<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>graph LR
  Store[Store]
  Processor[Processor]
  Container[Container]
  View[Presentational View]

  Processor -- state変更発行 --&gt; Store
  Store -- state変更通知 --&gt; Container
  Container -- UI更新 --&gt; View
  View -- trigger_event --&gt; Container
  Container -- action/イベント --&gt; Processor</code></pre>
<h3 id="_5">各コンポーネントの役割<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Store</strong>: Pydanticモデルでアプリの状態を一元管理。型安全なアクセス＆更新通知が得られます。</li>
<li><strong>Container</strong>: 状態を購読し、UIと連動。ユーザー操作から Processor への橋渡しも担う。</li>
<li><strong>Presentational</strong>: 受け取ったデータを表示するだけの純粋View。状態管理・ロジックは一切持たない。</li>
<li><strong>Processor</strong>: ビジネスロジック/状態変更を集中管理。PubSub経由でContainer/Storeと通信。</li>
</ul>
<hr />
<h2 id="_6">🎯 推奨インポートパターン<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pubsubtk</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">TkApplication</span><span class="p">,</span> <span class="n">ThemedApplication</span><span class="p">,</span>           <span class="c1"># アプリケーション</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">ContainerComponentTk</span><span class="p">,</span> <span class="n">ContainerComponentTtk</span><span class="p">,</span> <span class="c1"># コンテナ</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">PresentationalComponentTk</span><span class="p">,</span> <span class="n">PresentationalComponentTtk</span><span class="p">,</span> <span class="c1"># プレゼンテーション</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">ProcessorBase</span><span class="p">,</span>                              <span class="c1"># プロセッサ</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">tkinter</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tk</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tkinter</span><span class="w"> </span><span class="kn">import</span> <span class="n">ttk</span>
</span></code></pre></div>
<hr />
<h2 id="_7">主要メソッド一覧<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>メソッド</th>
<th>説明・用途</th>
<th>主な利用層</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pub_switch_container(cls, kwargs)</code></td>
<td>メイン画面（Container）を切り替える</td>
<td>Container / Processor</td>
</tr>
<tr>
<td><code>pub_switch_slot(slot_name, cls, kwargs)</code></td>
<td>テンプレート内の任意スロットのコンポーネントを切り替え</td>
<td>Container / Processor</td>
</tr>
<tr>
<td><code>pub_open_subwindow(cls, win_id, kwargs)</code></td>
<td>サブウィンドウを開く</td>
<td>Container / Processor</td>
</tr>
<tr>
<td><code>pub_close_subwindow(win_id)</code></td>
<td>指定 ID のサブウィンドウを閉じる</td>
<td>Container / Processor</td>
</tr>
<tr>
<td><code>pub_close_all_subwindows()</code></td>
<td>サブウィンドウをすべて閉じる</td>
<td>Container / Processor</td>
</tr>
<tr>
<td><code>pub_replace_state(new_state)</code></td>
<td>状態オブジェクト全体を置き換える</td>
<td>Processor / Container</td>
</tr>
<tr>
<td><code>pub_update_state(state_path, new_value)</code></td>
<td>任意パスの状態を型安全に更新</td>
<td>Processor / Container</td>
</tr>
<tr>
<td><code>pub_add_to_list(state_path, item)</code></td>
<td>リスト要素を型安全に追加</td>
<td>Processor / Container</td>
</tr>
<tr>
<td><code>pub_add_to_dict(state_path, key, value)</code></td>
<td>辞書要素を型安全に追加</td>
<td>Processor / Container</td>
</tr>
<tr>
<td><code>pub_register_processor(proc, name)</code></td>
<td>Processor を動的に登録</td>
<td>Processor</td>
</tr>
<tr>
<td><code>pub_delete_processor(name)</code></td>
<td>Processor を削除</td>
<td>Processor</td>
</tr>
<tr>
<td><code>pub_enable_undo_redo(state_path, max_history)</code></td>
<td>Undo/Redo 履歴を有効化</td>
<td>Processor / Container</td>
</tr>
<tr>
<td><code>pub_disable_undo_redo(state_path)</code></td>
<td>Undo/Redo 履歴を無効化</td>
<td>Processor / Container</td>
</tr>
<tr>
<td><code>pub_undo(state_path)</code></td>
<td>1つ前の値に戻す</td>
<td>Processor / Container</td>
</tr>
<tr>
<td><code>pub_redo(state_path)</code></td>
<td>Undo を取り消す</td>
<td>Processor / Container</td>
</tr>
<tr>
<td><code>sub_undo_status(state_path, handler)</code></td>
<td>Undo/Redo 状態変化を購読</td>
<td>Container</td>
</tr>
<tr>
<td><code>sub_state_changed(state_path, handler)</code></td>
<td>指定パスの値変更を購読（old_value, new_value受信）</td>
<td>Container</td>
</tr>
<tr>
<td><code>sub_for_refresh(state_path, handler)</code></td>
<td>状態更新時のUI再描画用シンプル通知を購読（引数なし）</td>
<td>Container</td>
</tr>
<tr>
<td><code>sub_state_added(state_path, handler)</code></td>
<td>リストへの要素追加を購読（item, index受信）</td>
<td>Container</td>
</tr>
<tr>
<td><code>sub_dict_item_added(state_path, handler)</code></td>
<td>辞書への要素追加を購読（key, value受信）</td>
<td>Container</td>
</tr>
<tr>
<td><code>register_handler(event, cb)</code></td>
<td>PresentationalコンポーネントでViewイベントのハンドラ登録</td>
<td>Container</td>
</tr>
<tr>
<td><code>trigger_event(event, **kwargs)</code></td>
<td>View→Containerへ任意イベント送出</td>
<td>Presentational</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="_8">開発のポイント<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<h3 id="stateproxyide">StateProxyによるIDE連携<a class="headerlink" href="#stateproxyide" title="Permanent link">&para;</a></h3>
<p>PubSubTkの最大の価値は、StateProxyによる強力なIDE連携です。</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># VSCode/PyCharmで以下が全て効く：</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="c1">#            ↑     ↑</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="c1">#    Ctrl+Click   Ctrl+Click</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="c1">#    で定義へ     で定義へ</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="c1"># ✅ F12: 定義へ移動</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="c1"># ✅ Shift+F12: すべての参照を検索  </span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="c1"># ✅ F2: 安全なリネーム</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="c1"># ✅ Ctrl+Space: 自動補完</span>
</span></code></pre></div>
<p><strong>str()が必要なタイミング：</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># ✅ 基本的な使用（str()不要）</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="bp">self</span><span class="o">.</span><span class="n">pub_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="bp">self</span><span class="o">.</span><span class="n">sub_state_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_todos_changed</span><span class="p">)</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="c1"># ✅ 文字列操作が必要な場合のみstr()を使用</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_backup&quot;</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="bp">self</span><span class="o">.</span><span class="n">pub_update_state</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;todos.</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">updated_todo</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="_9">コンポーネント設計指針<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p><strong>Container</strong> - 状態に依存する処理、ユーザー操作のハンドリング</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">TodoContainer</span><span class="p">(</span><span class="n">ContainerComponentTk</span><span class="p">[</span><span class="n">AppState</span><span class="p">]):</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub_state_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_todos_changed</span><span class="p">)</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_todo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>        <span class="c1"># 状態更新</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_add_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="p">,</span> <span class="n">new_todo</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>備考:</strong> コンポーネントの <code>__init__</code> では与えられた <code>*args</code> と <code>**kwargs</code> が
<code>self.args</code> / <code>self.kwargs</code> として保持されます。サブウィンドウを <code>open_subwindow</code>
で開く場合は <code>win_id</code> が <code>self.kwargs</code> に自動追加され、
<code>pub_close_subwindow(self.kwargs["win_id"])</code> で自身を閉じられます。今後も同様の
デフォルト引数が追加される可能性があります。</p>
<p><strong>Presentational</strong> - 純粋な表示、再利用可能な部品</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">TodoItemView</span><span class="p">(</span><span class="n">PresentationalComponentTk</span><span class="p">):</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">todo_item</span><span class="p">:</span> <span class="n">TodoItem</span><span class="p">):</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">todo_item</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_click</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>        <span class="c1"># Container側にイベント通知</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trigger_event</span><span class="p">(</span><span class="s2">&quot;toggle&quot;</span><span class="p">,</span> <span class="n">todo_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">todo_item</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>Template</strong> - レイアウト構造の定義、スロットベースの画面構成</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">AppTemplate</span><span class="p">(</span><span class="n">TemplateComponentTk</span><span class="p">[</span><span class="n">AppState</span><span class="p">]):</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">define_slots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>        <span class="c1"># 各領域を定義・配置</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">main</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>            <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">,</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>            <span class="s2">&quot;main&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">,</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>            <span class="s2">&quot;sidebar&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>        <span class="p">}</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="c1"># 使用例</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="n">app</span><span class="o">.</span><span class="n">set_template</span><span class="p">(</span><span class="n">AppTemplate</span><span class="p">)</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="n">app</span><span class="o">.</span><span class="n">pub_switch_slot</span><span class="p">(</span><span class="s2">&quot;header&quot;</span><span class="p">,</span> <span class="n">HeaderView</span><span class="p">)</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="n">app</span><span class="o">.</span><span class="n">pub_switch_slot</span><span class="p">(</span><span class="s2">&quot;sidebar&quot;</span><span class="p">,</span> <span class="n">NavigationPanel</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>Processor</strong> - ビジネスロジック、複雑な状態操作</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">TodoProcessor</span><span class="p">(</span><span class="n">ProcessorBase</span><span class="p">[</span><span class="n">AppState</span><span class="p">]):</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s2">&quot;todo.bulk_update&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_bulk_update</span><span class="p">)</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">handle_bulk_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">todo_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>        <span class="c1"># 複雑なロジック処理</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>        <span class="k">pass</span>
</span></code></pre></div>
<h3 id="undoredo">Undo/Redo 機能<a class="headerlink" href="#undoredo" title="Permanent link">&para;</a></h3>
<p>PubSubTk では、任意の状態パスを指定して Undo/Redo 履歴を管理できます。
<code>pub_enable_undo_redo()</code> で履歴を有効化すると自動的に変更が追跡され、
<code>pub_undo()</code> と <code>pub_redo()</code> で値を戻したりやり直したりできます。履歴数は
<code>max_history</code> 引数で調整してください。</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># Undo/Redo の有効化</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="bp">self</span><span class="o">.</span><span class="n">pub_enable_undo_redo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="p">),</span> <span class="n">max_history</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="c1"># 操作</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="bp">self</span><span class="o">.</span><span class="n">pub_undo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="p">))</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="bp">self</span><span class="o">.</span><span class="n">pub_redo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="p">))</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="c1"># 履歴追跡の停止</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="bp">self</span><span class="o">.</span><span class="n">pub_disable_undo_redo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="p">))</span>
</span></code></pre></div>
<p><code>sub_undo_status()</code> を使うと、Undo/Redo 可能かどうかや履歴数を購読できます。</p>
<h3 id="pubsub">カスタムトピック・PubSub拡張<a class="headerlink" href="#pubsub" title="Permanent link">&para;</a></h3>
<p><strong>AutoNamedTopicによるカスタムトピック作成</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pubsubtk</span><span class="w"> </span><span class="kn">import</span> <span class="n">AutoNamedTopic</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">auto</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">MyAppTopic</span><span class="p">(</span><span class="n">AutoNamedTopic</span><span class="p">):</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    <span class="n">USER_LOGIN</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>        <span class="c1"># -&gt; &quot;MyAppTopic.user_login&quot;</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    <span class="n">DATA_LOADED</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>       <span class="c1"># -&gt; &quot;MyAppTopic.data_loaded&quot;</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>    <span class="n">ERROR_OCCURRED</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>    <span class="c1"># -&gt; &quot;MyAppTopic.error_occurred&quot;</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>    <span class="n">FILE_EXPORT</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>       <span class="c1"># -&gt; &quot;MyAppTopic.file_export&quot;</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="c1"># 使用例</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">MyProcessor</span><span class="p">(</span><span class="n">ProcessorBase</span><span class="p">[</span><span class="n">AppState</span><span class="p">]):</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">MyAppTopic</span><span class="o">.</span><span class="n">USER_LOGIN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_user_login</span><span class="p">)</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">MyAppTopic</span><span class="o">.</span><span class="n">DATA_LOADED</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_data_loaded</span><span class="p">)</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">some_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>        <span class="c1"># カスタムトピックでメッセージ送信</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">MyAppTopic</span><span class="o">.</span><span class="n">FILE_EXPORT</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;csv&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;data.csv&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>デフォルトトピック vs カスタムトピックの使い分け</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># ✅ デフォルト便利メソッドを使用（推奨）</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="bp">self</span><span class="o">.</span><span class="n">pub_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>      <span class="c1"># 状態更新</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="bp">self</span><span class="o">.</span><span class="n">pub_switch_container</span><span class="p">(</span><span class="n">NewContainer</span><span class="p">)</span>                <span class="c1"># 画面切り替え</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="bp">self</span><span class="o">.</span><span class="n">pub_open_subwindow</span><span class="p">(</span><span class="n">DialogContainer</span><span class="p">)</span>               <span class="c1"># サブウィンドウ</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="bp">self</span><span class="o">.</span><span class="n">pub_enable_undo_redo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>               <span class="c1"># Undo履歴を開始</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="bp">self</span><span class="o">.</span><span class="n">pub_undo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>                    <span class="c1"># Undo</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="bp">self</span><span class="o">.</span><span class="n">pub_redo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>                    <span class="c1"># Redo</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="bp">self</span><span class="o">.</span><span class="n">pub_disable_undo_redo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>      <span class="c1"># 履歴停止</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="c1"># ✅ カスタムトピックを使用（ビジネスロジック特有の通信）</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="bp">self</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">MyAppTopic</span><span class="o">.</span><span class="n">USER_LOGIN</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>       <span class="c1"># アプリ固有のイベント</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">MyAppTopic</span><span class="o">.</span><span class="n">DATA_LOADED</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_data</span><span class="p">)</span>   <span class="c1"># 複雑なワークフロー</span>
</span></code></pre></div>
<h3 id="_10">よくある問題と解決法<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p><strong>StateProxy使用時のエラー</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># ❌ エラーになる例</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;old&quot;</span><span class="p">,</span> <span class="s2">&quot;new&quot;</span><span class="p">)</span>  <span class="c1"># AttributeError</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="c1"># ✅ 正しい使い方</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;old&quot;</span><span class="p">,</span> <span class="s2">&quot;new&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>便利メソッドの活用</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># ✅ 推奨: 組み込みメソッドを使用</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="bp">self</span><span class="o">.</span><span class="n">pub_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="bp">self</span><span class="o">.</span><span class="n">pub_switch_container</span><span class="p">(</span><span class="n">OtherContainer</span><span class="p">)</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="bp">self</span><span class="o">.</span><span class="n">pub_enable_undo_redo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="bp">self</span><span class="o">.</span><span class="n">pub_undo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="bp">self</span><span class="o">.</span><span class="n">pub_redo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="bp">self</span><span class="o">.</span><span class="n">pub_disable_undo_redo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="c1"># ❌ 非推奨: 手動でトピック操作</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="bp">self</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">DefaultUpdateTopic</span><span class="o">.</span><span class="n">UPDATE_STATE</span><span class="p">,</span> <span class="n">state_path</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">new_value</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</span></code></pre></div>
<hr />
<h2 id="_11">実践例<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h2>
<h3 id="_12">全機能を活用したシンプルなカウンターアプリ<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<p>PubSubDefaultTopicBaseの全メソッドを使用した小規模なデモアプリケーション</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="sd">PubSubTk 全機能コンパクトデモ</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="sd">PubSubDefaultTopicBaseの全メソッドを使用した小規模なデモアプリケーション</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">tkinter</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tk</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">auto</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tkinter</span><span class="w"> </span><span class="kn">import</span> <span class="n">filedialog</span><span class="p">,</span> <span class="n">messagebox</span><span class="p">,</span> <span class="n">simpledialog</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pubsubtk</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>    <span class="n">AutoNamedTopic</span><span class="p">,</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>    <span class="n">ContainerComponentTk</span><span class="p">,</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>    <span class="n">PresentationalComponentTk</span><span class="p">,</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>    <span class="n">ProcessorBase</span><span class="p">,</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>    <span class="n">TemplateComponentTk</span><span class="p">,</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>    <span class="n">TkApplication</span><span class="p">,</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>    <span class="n">make_async_task</span><span class="p">,</span>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="p">)</span>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="c1"># カスタムトピック</span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a><span class="k">class</span><span class="w"> </span><span class="nc">AppTopic</span><span class="p">(</span><span class="n">AutoNamedTopic</span><span class="p">):</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a>    <span class="n">INCREMENT</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a>    <span class="n">RESET</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a>    <span class="n">MILESTONE</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a>
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a>
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a><span class="c1"># データモデル</span>
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a><span class="k">class</span><span class="w"> </span><span class="nc">TodoItem</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a>    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-12-37"><a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a>    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-12-38"><a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a>    <span class="n">completed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-12-39"><a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a>
</span><span id="__span-12-40"><a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a>
</span><span id="__span-12-41"><a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a><span class="k">class</span><span class="w"> </span><span class="nc">AppState</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span id="__span-12-42"><a id="__codelineno-12-42" name="__codelineno-12-42" href="#__codelineno-12-42"></a>    <span class="n">counter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-12-43"><a id="__codelineno-12-43" name="__codelineno-12-43" href="#__codelineno-12-43"></a>    <span class="n">total_clicks</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-12-44"><a id="__codelineno-12-44" name="__codelineno-12-44" href="#__codelineno-12-44"></a>    <span class="n">todos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TodoItem</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-12-45"><a id="__codelineno-12-45" name="__codelineno-12-45" href="#__codelineno-12-45"></a>    <span class="n">next_todo_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-12-46"><a id="__codelineno-12-46" name="__codelineno-12-46" href="#__codelineno-12-46"></a>    <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;theme&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="s2">&quot;auto_save&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">}</span>
</span><span id="__span-12-47"><a id="__codelineno-12-47" name="__codelineno-12-47" href="#__codelineno-12-47"></a>    <span class="n">current_view</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;main&quot;</span>
</span><span id="__span-12-48"><a id="__codelineno-12-48" name="__codelineno-12-48" href="#__codelineno-12-48"></a>
</span><span id="__span-12-49"><a id="__codelineno-12-49" name="__codelineno-12-49" href="#__codelineno-12-49"></a>
</span><span id="__span-12-50"><a id="__codelineno-12-50" name="__codelineno-12-50" href="#__codelineno-12-50"></a><span class="c1"># =============================================================================</span>
</span><span id="__span-12-51"><a id="__codelineno-12-51" name="__codelineno-12-51" href="#__codelineno-12-51"></a><span class="c1"># テンプレート（3スロット構成）</span>
</span><span id="__span-12-52"><a id="__codelineno-12-52" name="__codelineno-12-52" href="#__codelineno-12-52"></a><span class="c1"># =============================================================================</span>
</span><span id="__span-12-53"><a id="__codelineno-12-53" name="__codelineno-12-53" href="#__codelineno-12-53"></a>
</span><span id="__span-12-54"><a id="__codelineno-12-54" name="__codelineno-12-54" href="#__codelineno-12-54"></a>
</span><span id="__span-12-55"><a id="__codelineno-12-55" name="__codelineno-12-55" href="#__codelineno-12-55"></a><span class="k">class</span><span class="w"> </span><span class="nc">AppTemplate</span><span class="p">(</span><span class="n">TemplateComponentTk</span><span class="p">[</span><span class="n">AppState</span><span class="p">]):</span>
</span><span id="__span-12-56"><a id="__codelineno-12-56" name="__codelineno-12-56" href="#__codelineno-12-56"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">define_slots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-57"><a id="__codelineno-12-57" name="__codelineno-12-57" href="#__codelineno-12-57"></a>        <span class="c1"># ナビゲーション</span>
</span><span id="__span-12-58"><a id="__codelineno-12-58" name="__codelineno-12-58" href="#__codelineno-12-58"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">navbar</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;navy&quot;</span><span class="p">)</span>
</span><span id="__span-12-59"><a id="__codelineno-12-59" name="__codelineno-12-59" href="#__codelineno-12-59"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">navbar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
</span><span id="__span-12-60"><a id="__codelineno-12-60" name="__codelineno-12-60" href="#__codelineno-12-60"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">navbar</span><span class="o">.</span><span class="n">pack_propagate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-12-61"><a id="__codelineno-12-61" name="__codelineno-12-61" href="#__codelineno-12-61"></a>
</span><span id="__span-12-62"><a id="__codelineno-12-62" name="__codelineno-12-62" href="#__codelineno-12-62"></a>        <span class="c1"># メインコンテンツ</span>
</span><span id="__span-12-63"><a id="__codelineno-12-63" name="__codelineno-12-63" href="#__codelineno-12-63"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">main_area</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-12-64"><a id="__codelineno-12-64" name="__codelineno-12-64" href="#__codelineno-12-64"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">main_area</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">)</span>
</span><span id="__span-12-65"><a id="__codelineno-12-65" name="__codelineno-12-65" href="#__codelineno-12-65"></a>
</span><span id="__span-12-66"><a id="__codelineno-12-66" name="__codelineno-12-66" href="#__codelineno-12-66"></a>        <span class="c1"># サイドバー</span>
</span><span id="__span-12-67"><a id="__codelineno-12-67" name="__codelineno-12-67" href="#__codelineno-12-67"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">)</span>
</span><span id="__span-12-68"><a id="__codelineno-12-68" name="__codelineno-12-68" href="#__codelineno-12-68"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">)</span>
</span><span id="__span-12-69"><a id="__codelineno-12-69" name="__codelineno-12-69" href="#__codelineno-12-69"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">pack_propagate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-12-70"><a id="__codelineno-12-70" name="__codelineno-12-70" href="#__codelineno-12-70"></a>
</span><span id="__span-12-71"><a id="__codelineno-12-71" name="__codelineno-12-71" href="#__codelineno-12-71"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-12-72"><a id="__codelineno-12-72" name="__codelineno-12-72" href="#__codelineno-12-72"></a>            <span class="s2">&quot;navbar&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">navbar</span><span class="p">,</span>
</span><span id="__span-12-73"><a id="__codelineno-12-73" name="__codelineno-12-73" href="#__codelineno-12-73"></a>            <span class="s2">&quot;main&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_area</span><span class="p">,</span>
</span><span id="__span-12-74"><a id="__codelineno-12-74" name="__codelineno-12-74" href="#__codelineno-12-74"></a>            <span class="s2">&quot;sidebar&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebar</span><span class="p">,</span>
</span><span id="__span-12-75"><a id="__codelineno-12-75" name="__codelineno-12-75" href="#__codelineno-12-75"></a>        <span class="p">}</span>
</span><span id="__span-12-76"><a id="__codelineno-12-76" name="__codelineno-12-76" href="#__codelineno-12-76"></a>
</span><span id="__span-12-77"><a id="__codelineno-12-77" name="__codelineno-12-77" href="#__codelineno-12-77"></a>
</span><span id="__span-12-78"><a id="__codelineno-12-78" name="__codelineno-12-78" href="#__codelineno-12-78"></a><span class="c1"># =============================================================================</span>
</span><span id="__span-12-79"><a id="__codelineno-12-79" name="__codelineno-12-79" href="#__codelineno-12-79"></a><span class="c1"># Presentationalコンポーネント（純粋表示）</span>
</span><span id="__span-12-80"><a id="__codelineno-12-80" name="__codelineno-12-80" href="#__codelineno-12-80"></a><span class="c1"># =============================================================================</span>
</span><span id="__span-12-81"><a id="__codelineno-12-81" name="__codelineno-12-81" href="#__codelineno-12-81"></a>
</span><span id="__span-12-82"><a id="__codelineno-12-82" name="__codelineno-12-82" href="#__codelineno-12-82"></a>
</span><span id="__span-12-83"><a id="__codelineno-12-83" name="__codelineno-12-83" href="#__codelineno-12-83"></a><span class="k">class</span><span class="w"> </span><span class="nc">UndoRedoControlView</span><span class="p">(</span><span class="n">PresentationalComponentTk</span><span class="p">):</span>
</span><span id="__span-12-84"><a id="__codelineno-12-84" name="__codelineno-12-84" href="#__codelineno-12-84"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Undo/Redo操作用のPresentationalコンポーネント&quot;&quot;&quot;</span>
</span><span id="__span-12-85"><a id="__codelineno-12-85" name="__codelineno-12-85" href="#__codelineno-12-85"></a>
</span><span id="__span-12-86"><a id="__codelineno-12-86" name="__codelineno-12-86" href="#__codelineno-12-86"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-87"><a id="__codelineno-12-87" name="__codelineno-12-87" href="#__codelineno-12-87"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">RIDGE</span><span class="p">,</span> <span class="n">borderwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;lightyellow&quot;</span><span class="p">)</span>
</span><span id="__span-12-88"><a id="__codelineno-12-88" name="__codelineno-12-88" href="#__codelineno-12-88"></a>
</span><span id="__span-12-89"><a id="__codelineno-12-89" name="__codelineno-12-89" href="#__codelineno-12-89"></a>        <span class="c1"># タイトル</span>
</span><span id="__span-12-90"><a id="__codelineno-12-90" name="__codelineno-12-90" href="#__codelineno-12-90"></a>        <span class="n">title_label</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
</span><span id="__span-12-91"><a id="__codelineno-12-91" name="__codelineno-12-91" href="#__codelineno-12-91"></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;🔄 履歴操作&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;bold&quot;</span><span class="p">),</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;lightyellow&quot;</span>
</span><span id="__span-12-92"><a id="__codelineno-12-92" name="__codelineno-12-92" href="#__codelineno-12-92"></a>        <span class="p">)</span>
</span><span id="__span-12-93"><a id="__codelineno-12-93" name="__codelineno-12-93" href="#__codelineno-12-93"></a>        <span class="n">title_label</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-12-94"><a id="__codelineno-12-94" name="__codelineno-12-94" href="#__codelineno-12-94"></a>
</span><span id="__span-12-95"><a id="__codelineno-12-95" name="__codelineno-12-95" href="#__codelineno-12-95"></a>        <span class="c1"># ボタンフレーム</span>
</span><span id="__span-12-96"><a id="__codelineno-12-96" name="__codelineno-12-96" href="#__codelineno-12-96"></a>        <span class="n">btn_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;lightyellow&quot;</span><span class="p">)</span>
</span><span id="__span-12-97"><a id="__codelineno-12-97" name="__codelineno-12-97" href="#__codelineno-12-97"></a>        <span class="n">btn_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-12-98"><a id="__codelineno-12-98" name="__codelineno-12-98" href="#__codelineno-12-98"></a>
</span><span id="__span-12-99"><a id="__codelineno-12-99" name="__codelineno-12-99" href="#__codelineno-12-99"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">undo_btn</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">btn_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;← Undo&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;disabled&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span><span id="__span-12-100"><a id="__codelineno-12-100" name="__codelineno-12-100" href="#__codelineno-12-100"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">undo_btn</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-12-101"><a id="__codelineno-12-101" name="__codelineno-12-101" href="#__codelineno-12-101"></a>
</span><span id="__span-12-102"><a id="__codelineno-12-102" name="__codelineno-12-102" href="#__codelineno-12-102"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">redo_btn</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">btn_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Redo →&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;disabled&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span><span id="__span-12-103"><a id="__codelineno-12-103" name="__codelineno-12-103" href="#__codelineno-12-103"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">redo_btn</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-12-104"><a id="__codelineno-12-104" name="__codelineno-12-104" href="#__codelineno-12-104"></a>
</span><span id="__span-12-105"><a id="__codelineno-12-105" name="__codelineno-12-105" href="#__codelineno-12-105"></a>        <span class="c1"># ステータス表示</span>
</span><span id="__span-12-106"><a id="__codelineno-12-106" name="__codelineno-12-106" href="#__codelineno-12-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
</span><span id="__span-12-107"><a id="__codelineno-12-107" name="__codelineno-12-107" href="#__codelineno-12-107"></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;無効&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;lightyellow&quot;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span>
</span><span id="__span-12-108"><a id="__codelineno-12-108" name="__codelineno-12-108" href="#__codelineno-12-108"></a>        <span class="p">)</span>
</span><span id="__span-12-109"><a id="__codelineno-12-109" name="__codelineno-12-109" href="#__codelineno-12-109"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-12-110"><a id="__codelineno-12-110" name="__codelineno-12-110" href="#__codelineno-12-110"></a>
</span><span id="__span-12-111"><a id="__codelineno-12-111" name="__codelineno-12-111" href="#__codelineno-12-111"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">undo_handler</span><span class="p">,</span> <span class="n">redo_handler</span><span class="p">):</span>
</span><span id="__span-12-112"><a id="__codelineno-12-112" name="__codelineno-12-112" href="#__codelineno-12-112"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Undo/Redoハンドラーを設定&quot;&quot;&quot;</span>
</span><span id="__span-12-113"><a id="__codelineno-12-113" name="__codelineno-12-113" href="#__codelineno-12-113"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">undo_btn</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">undo_handler</span><span class="p">)</span>
</span><span id="__span-12-114"><a id="__codelineno-12-114" name="__codelineno-12-114" href="#__codelineno-12-114"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">redo_btn</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">redo_handler</span><span class="p">)</span>
</span><span id="__span-12-115"><a id="__codelineno-12-115" name="__codelineno-12-115" href="#__codelineno-12-115"></a>
</span><span id="__span-12-116"><a id="__codelineno-12-116" name="__codelineno-12-116" href="#__codelineno-12-116"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_status</span><span class="p">(</span>
</span><span id="__span-12-117"><a id="__codelineno-12-117" name="__codelineno-12-117" href="#__codelineno-12-117"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">can_undo</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">can_redo</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">undo_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">redo_count</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-12-118"><a id="__codelineno-12-118" name="__codelineno-12-118" href="#__codelineno-12-118"></a>    <span class="p">):</span>
</span><span id="__span-12-119"><a id="__codelineno-12-119" name="__codelineno-12-119" href="#__codelineno-12-119"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Undo/Redoステータスを更新&quot;&quot;&quot;</span>
</span><span id="__span-12-120"><a id="__codelineno-12-120" name="__codelineno-12-120" href="#__codelineno-12-120"></a>        <span class="c1"># ボタンの有効/無効状態</span>
</span><span id="__span-12-121"><a id="__codelineno-12-121" name="__codelineno-12-121" href="#__codelineno-12-121"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">undo_btn</span><span class="o">.</span><span class="n">config</span><span class="p">(</span>
</span><span id="__span-12-122"><a id="__codelineno-12-122" name="__codelineno-12-122" href="#__codelineno-12-122"></a>            <span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span> <span class="k">if</span> <span class="n">can_undo</span> <span class="k">else</span> <span class="s2">&quot;disabled&quot;</span><span class="p">,</span>
</span><span id="__span-12-123"><a id="__codelineno-12-123" name="__codelineno-12-123" href="#__codelineno-12-123"></a>            <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;← Undo (</span><span class="si">{</span><span class="n">undo_count</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">if</span> <span class="n">undo_count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;← Undo&quot;</span><span class="p">,</span>
</span><span id="__span-12-124"><a id="__codelineno-12-124" name="__codelineno-12-124" href="#__codelineno-12-124"></a>        <span class="p">)</span>
</span><span id="__span-12-125"><a id="__codelineno-12-125" name="__codelineno-12-125" href="#__codelineno-12-125"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">redo_btn</span><span class="o">.</span><span class="n">config</span><span class="p">(</span>
</span><span id="__span-12-126"><a id="__codelineno-12-126" name="__codelineno-12-126" href="#__codelineno-12-126"></a>            <span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span> <span class="k">if</span> <span class="n">can_redo</span> <span class="k">else</span> <span class="s2">&quot;disabled&quot;</span><span class="p">,</span>
</span><span id="__span-12-127"><a id="__codelineno-12-127" name="__codelineno-12-127" href="#__codelineno-12-127"></a>            <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Redo (</span><span class="si">{</span><span class="n">redo_count</span><span class="si">}</span><span class="s2">) →&quot;</span> <span class="k">if</span> <span class="n">redo_count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;Redo →&quot;</span><span class="p">,</span>
</span><span id="__span-12-128"><a id="__codelineno-12-128" name="__codelineno-12-128" href="#__codelineno-12-128"></a>        <span class="p">)</span>
</span><span id="__span-12-129"><a id="__codelineno-12-129" name="__codelineno-12-129" href="#__codelineno-12-129"></a>
</span><span id="__span-12-130"><a id="__codelineno-12-130" name="__codelineno-12-130" href="#__codelineno-12-130"></a>        <span class="c1"># ステータステキスト</span>
</span><span id="__span-12-131"><a id="__codelineno-12-131" name="__codelineno-12-131" href="#__codelineno-12-131"></a>        <span class="k">if</span> <span class="n">can_undo</span> <span class="ow">or</span> <span class="n">can_redo</span><span class="p">:</span>
</span><span id="__span-12-132"><a id="__codelineno-12-132" name="__codelineno-12-132" href="#__codelineno-12-132"></a>            <span class="n">status</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Undo:</span><span class="si">{</span><span class="n">undo_count</span><span class="si">}</span><span class="s2"> Redo:</span><span class="si">{</span><span class="n">redo_count</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-12-133"><a id="__codelineno-12-133" name="__codelineno-12-133" href="#__codelineno-12-133"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">status</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
</span><span id="__span-12-134"><a id="__codelineno-12-134" name="__codelineno-12-134" href="#__codelineno-12-134"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-12-135"><a id="__codelineno-12-135" name="__codelineno-12-135" href="#__codelineno-12-135"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;履歴なし&quot;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="__span-12-136"><a id="__codelineno-12-136" name="__codelineno-12-136" href="#__codelineno-12-136"></a>
</span><span id="__span-12-137"><a id="__codelineno-12-137" name="__codelineno-12-137" href="#__codelineno-12-137"></a>
</span><span id="__span-12-138"><a id="__codelineno-12-138" name="__codelineno-12-138" href="#__codelineno-12-138"></a><span class="k">class</span><span class="w"> </span><span class="nc">TodoItemView</span><span class="p">(</span><span class="n">PresentationalComponentTk</span><span class="p">):</span>
</span><span id="__span-12-139"><a id="__codelineno-12-139" name="__codelineno-12-139" href="#__codelineno-12-139"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-140"><a id="__codelineno-12-140" name="__codelineno-12-140" href="#__codelineno-12-140"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">RAISED</span><span class="p">,</span> <span class="n">borderwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-12-141"><a id="__codelineno-12-141" name="__codelineno-12-141" href="#__codelineno-12-141"></a>
</span><span id="__span-12-142"><a id="__codelineno-12-142" name="__codelineno-12-142" href="#__codelineno-12-142"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">BooleanVar</span><span class="p">()</span>
</span><span id="__span-12-143"><a id="__codelineno-12-143" name="__codelineno-12-143" href="#__codelineno-12-143"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Checkbutton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_toggle</span><span class="p">)</span>
</span><span id="__span-12-144"><a id="__codelineno-12-144" name="__codelineno-12-144" href="#__codelineno-12-144"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">)</span>
</span><span id="__span-12-145"><a id="__codelineno-12-145" name="__codelineno-12-145" href="#__codelineno-12-145"></a>
</span><span id="__span-12-146"><a id="__codelineno-12-146" name="__codelineno-12-146" href="#__codelineno-12-146"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="__span-12-147"><a id="__codelineno-12-147" name="__codelineno-12-147" href="#__codelineno-12-147"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-12-148"><a id="__codelineno-12-148" name="__codelineno-12-148" href="#__codelineno-12-148"></a>
</span><span id="__span-12-149"><a id="__codelineno-12-149" name="__codelineno-12-149" href="#__codelineno-12-149"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">delete_btn</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;×&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_delete</span><span class="p">)</span>
</span><span id="__span-12-150"><a id="__codelineno-12-150" name="__codelineno-12-150" href="#__codelineno-12-150"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">delete_btn</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">)</span>
</span><span id="__span-12-151"><a id="__codelineno-12-151" name="__codelineno-12-151" href="#__codelineno-12-151"></a>
</span><span id="__span-12-152"><a id="__codelineno-12-152" name="__codelineno-12-152" href="#__codelineno-12-152"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">todo</span><span class="p">:</span> <span class="n">TodoItem</span><span class="p">):</span>
</span><span id="__span-12-153"><a id="__codelineno-12-153" name="__codelineno-12-153" href="#__codelineno-12-153"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">todo</span> <span class="o">=</span> <span class="n">todo</span>
</span><span id="__span-12-154"><a id="__codelineno-12-154" name="__codelineno-12-154" href="#__codelineno-12-154"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">todo</span><span class="o">.</span><span class="n">completed</span><span class="p">)</span>
</span><span id="__span-12-155"><a id="__codelineno-12-155" name="__codelineno-12-155" href="#__codelineno-12-155"></a>        <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;✓ </span><span class="si">{</span><span class="n">todo</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">todo</span><span class="o">.</span><span class="n">completed</span> <span class="k">else</span> <span class="n">todo</span><span class="o">.</span><span class="n">text</span>
</span><span id="__span-12-156"><a id="__codelineno-12-156" name="__codelineno-12-156" href="#__codelineno-12-156"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span> <span class="k">if</span> <span class="n">todo</span><span class="o">.</span><span class="n">completed</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>
</span><span id="__span-12-157"><a id="__codelineno-12-157" name="__codelineno-12-157" href="#__codelineno-12-157"></a>
</span><span id="__span-12-158"><a id="__codelineno-12-158" name="__codelineno-12-158" href="#__codelineno-12-158"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_toggle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-159"><a id="__codelineno-12-159" name="__codelineno-12-159" href="#__codelineno-12-159"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trigger_event</span><span class="p">(</span><span class="s2">&quot;toggle&quot;</span><span class="p">,</span> <span class="n">todo_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">todo</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="__span-12-160"><a id="__codelineno-12-160" name="__codelineno-12-160" href="#__codelineno-12-160"></a>
</span><span id="__span-12-161"><a id="__codelineno-12-161" name="__codelineno-12-161" href="#__codelineno-12-161"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-162"><a id="__codelineno-12-162" name="__codelineno-12-162" href="#__codelineno-12-162"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trigger_event</span><span class="p">(</span><span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="n">todo_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">todo</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="__span-12-163"><a id="__codelineno-12-163" name="__codelineno-12-163" href="#__codelineno-12-163"></a>
</span><span id="__span-12-164"><a id="__codelineno-12-164" name="__codelineno-12-164" href="#__codelineno-12-164"></a>
</span><span id="__span-12-165"><a id="__codelineno-12-165" name="__codelineno-12-165" href="#__codelineno-12-165"></a><span class="k">class</span><span class="w"> </span><span class="nc">StatsView</span><span class="p">(</span><span class="n">PresentationalComponentTk</span><span class="p">):</span>
</span><span id="__span-12-166"><a id="__codelineno-12-166" name="__codelineno-12-166" href="#__codelineno-12-166"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-167"><a id="__codelineno-12-167" name="__codelineno-12-167" href="#__codelineno-12-167"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="s2">&quot;lightblue&quot;</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">SUNKEN</span><span class="p">,</span> <span class="n">borderwidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-12-168"><a id="__codelineno-12-168" name="__codelineno-12-168" href="#__codelineno-12-168"></a>
</span><span id="__span-12-169"><a id="__codelineno-12-169" name="__codelineno-12-169" href="#__codelineno-12-169"></a>        <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;📊 統計&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;bold&quot;</span><span class="p">),</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;lightblue&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
</span><span id="__span-12-170"><a id="__codelineno-12-170" name="__codelineno-12-170" href="#__codelineno-12-170"></a>            <span class="n">pady</span><span class="o">=</span><span class="mi">5</span>
</span><span id="__span-12-171"><a id="__codelineno-12-171" name="__codelineno-12-171" href="#__codelineno-12-171"></a>        <span class="p">)</span>
</span><span id="__span-12-172"><a id="__codelineno-12-172" name="__codelineno-12-172" href="#__codelineno-12-172"></a>
</span><span id="__span-12-173"><a id="__codelineno-12-173" name="__codelineno-12-173" href="#__codelineno-12-173"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats_label</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;lightblue&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">)</span>
</span><span id="__span-12-174"><a id="__codelineno-12-174" name="__codelineno-12-174" href="#__codelineno-12-174"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats_label</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-12-175"><a id="__codelineno-12-175" name="__codelineno-12-175" href="#__codelineno-12-175"></a>
</span><span id="__span-12-176"><a id="__codelineno-12-176" name="__codelineno-12-176" href="#__codelineno-12-176"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_stats</span><span class="p">(</span>
</span><span id="__span-12-177"><a id="__codelineno-12-177" name="__codelineno-12-177" href="#__codelineno-12-177"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-12-178"><a id="__codelineno-12-178" name="__codelineno-12-178" href="#__codelineno-12-178"></a>        <span class="n">counter</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-12-179"><a id="__codelineno-12-179" name="__codelineno-12-179" href="#__codelineno-12-179"></a>        <span class="n">total_clicks</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-12-180"><a id="__codelineno-12-180" name="__codelineno-12-180" href="#__codelineno-12-180"></a>        <span class="n">total_todos</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-12-181"><a id="__codelineno-12-181" name="__codelineno-12-181" href="#__codelineno-12-181"></a>        <span class="n">completed_todos</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-12-182"><a id="__codelineno-12-182" name="__codelineno-12-182" href="#__codelineno-12-182"></a>        <span class="n">settings_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-12-183"><a id="__codelineno-12-183" name="__codelineno-12-183" href="#__codelineno-12-183"></a>        <span class="n">current_view</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-12-184"><a id="__codelineno-12-184" name="__codelineno-12-184" href="#__codelineno-12-184"></a>        <span class="n">counter_undo_status</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-12-185"><a id="__codelineno-12-185" name="__codelineno-12-185" href="#__codelineno-12-185"></a>        <span class="n">todos_undo_status</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-12-186"><a id="__codelineno-12-186" name="__codelineno-12-186" href="#__codelineno-12-186"></a>    <span class="p">):</span>
</span><span id="__span-12-187"><a id="__codelineno-12-187" name="__codelineno-12-187" href="#__codelineno-12-187"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;純粋な表示コンポーネント - 必要なデータのみを個別に受け取る&quot;&quot;&quot;</span>
</span><span id="__span-12-188"><a id="__codelineno-12-188" name="__codelineno-12-188" href="#__codelineno-12-188"></a>        <span class="n">uncompleted</span> <span class="o">=</span> <span class="n">total_todos</span> <span class="o">-</span> <span class="n">completed_todos</span>
</span><span id="__span-12-189"><a id="__codelineno-12-189" name="__codelineno-12-189" href="#__codelineno-12-189"></a>
</span><span id="__span-12-190"><a id="__codelineno-12-190" name="__codelineno-12-190" href="#__codelineno-12-190"></a>        <span class="c1"># デフォルト値設定</span>
</span><span id="__span-12-191"><a id="__codelineno-12-191" name="__codelineno-12-191" href="#__codelineno-12-191"></a>        <span class="n">counter_undo_status</span> <span class="o">=</span> <span class="n">counter_undo_status</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="__span-12-192"><a id="__codelineno-12-192" name="__codelineno-12-192" href="#__codelineno-12-192"></a>            <span class="s2">&quot;can_undo&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-12-193"><a id="__codelineno-12-193" name="__codelineno-12-193" href="#__codelineno-12-193"></a>            <span class="s2">&quot;can_redo&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-12-194"><a id="__codelineno-12-194" name="__codelineno-12-194" href="#__codelineno-12-194"></a>            <span class="s2">&quot;undo_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-12-195"><a id="__codelineno-12-195" name="__codelineno-12-195" href="#__codelineno-12-195"></a>            <span class="s2">&quot;redo_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-12-196"><a id="__codelineno-12-196" name="__codelineno-12-196" href="#__codelineno-12-196"></a>        <span class="p">}</span>
</span><span id="__span-12-197"><a id="__codelineno-12-197" name="__codelineno-12-197" href="#__codelineno-12-197"></a>        <span class="n">todos_undo_status</span> <span class="o">=</span> <span class="n">todos_undo_status</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="__span-12-198"><a id="__codelineno-12-198" name="__codelineno-12-198" href="#__codelineno-12-198"></a>            <span class="s2">&quot;can_undo&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-12-199"><a id="__codelineno-12-199" name="__codelineno-12-199" href="#__codelineno-12-199"></a>            <span class="s2">&quot;can_redo&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-12-200"><a id="__codelineno-12-200" name="__codelineno-12-200" href="#__codelineno-12-200"></a>            <span class="s2">&quot;undo_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-12-201"><a id="__codelineno-12-201" name="__codelineno-12-201" href="#__codelineno-12-201"></a>            <span class="s2">&quot;redo_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-12-202"><a id="__codelineno-12-202" name="__codelineno-12-202" href="#__codelineno-12-202"></a>        <span class="p">}</span>
</span><span id="__span-12-203"><a id="__codelineno-12-203" name="__codelineno-12-203" href="#__codelineno-12-203"></a>
</span><span id="__span-12-204"><a id="__codelineno-12-204" name="__codelineno-12-204" href="#__codelineno-12-204"></a>        <span class="n">stats</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;カウンター: </span><span class="si">{</span><span class="n">counter</span><span class="si">}</span>
</span><span id="__span-12-205"><a id="__codelineno-12-205" name="__codelineno-12-205" href="#__codelineno-12-205"></a><span class="s2">総クリック: </span><span class="si">{</span><span class="n">total_clicks</span><span class="si">}</span>
</span><span id="__span-12-206"><a id="__codelineno-12-206" name="__codelineno-12-206" href="#__codelineno-12-206"></a>
</span><span id="__span-12-207"><a id="__codelineno-12-207" name="__codelineno-12-207" href="#__codelineno-12-207"></a><span class="s2">Todo統計:</span>
</span><span id="__span-12-208"><a id="__codelineno-12-208" name="__codelineno-12-208" href="#__codelineno-12-208"></a><span class="s2">・総数: </span><span class="si">{</span><span class="n">total_todos</span><span class="si">}</span>
</span><span id="__span-12-209"><a id="__codelineno-12-209" name="__codelineno-12-209" href="#__codelineno-12-209"></a><span class="s2">・完了: </span><span class="si">{</span><span class="n">completed_todos</span><span class="si">}</span>
</span><span id="__span-12-210"><a id="__codelineno-12-210" name="__codelineno-12-210" href="#__codelineno-12-210"></a><span class="s2">・未完了: </span><span class="si">{</span><span class="n">uncompleted</span><span class="si">}</span>
</span><span id="__span-12-211"><a id="__codelineno-12-211" name="__codelineno-12-211" href="#__codelineno-12-211"></a>
</span><span id="__span-12-212"><a id="__codelineno-12-212" name="__codelineno-12-212" href="#__codelineno-12-212"></a><span class="s2">設定数: </span><span class="si">{</span><span class="n">settings_count</span><span class="si">}</span>
</span><span id="__span-12-213"><a id="__codelineno-12-213" name="__codelineno-12-213" href="#__codelineno-12-213"></a><span class="s2">現在画面: </span><span class="si">{</span><span class="n">current_view</span><span class="si">}</span>
</span><span id="__span-12-214"><a id="__codelineno-12-214" name="__codelineno-12-214" href="#__codelineno-12-214"></a>
</span><span id="__span-12-215"><a id="__codelineno-12-215" name="__codelineno-12-215" href="#__codelineno-12-215"></a><span class="s2">🔄 履歴状況:</span>
</span><span id="__span-12-216"><a id="__codelineno-12-216" name="__codelineno-12-216" href="#__codelineno-12-216"></a><span class="s2">カウンター履歴:</span>
</span><span id="__span-12-217"><a id="__codelineno-12-217" name="__codelineno-12-217" href="#__codelineno-12-217"></a><span class="s2">・Undo: </span><span class="si">{</span><span class="n">counter_undo_status</span><span class="p">[</span><span class="s2">&quot;undo_count&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2">回</span>
</span><span id="__span-12-218"><a id="__codelineno-12-218" name="__codelineno-12-218" href="#__codelineno-12-218"></a><span class="s2">・Redo: </span><span class="si">{</span><span class="n">counter_undo_status</span><span class="p">[</span><span class="s2">&quot;redo_count&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2">回</span>
</span><span id="__span-12-219"><a id="__codelineno-12-219" name="__codelineno-12-219" href="#__codelineno-12-219"></a>
</span><span id="__span-12-220"><a id="__codelineno-12-220" name="__codelineno-12-220" href="#__codelineno-12-220"></a><span class="s2">Todo履歴:</span>
</span><span id="__span-12-221"><a id="__codelineno-12-221" name="__codelineno-12-221" href="#__codelineno-12-221"></a><span class="s2">・Undo: </span><span class="si">{</span><span class="n">todos_undo_status</span><span class="p">[</span><span class="s2">&quot;undo_count&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2">回</span>
</span><span id="__span-12-222"><a id="__codelineno-12-222" name="__codelineno-12-222" href="#__codelineno-12-222"></a><span class="s2">・Redo: </span><span class="si">{</span><span class="n">todos_undo_status</span><span class="p">[</span><span class="s2">&quot;redo_count&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2">回&quot;&quot;&quot;</span>
</span><span id="__span-12-223"><a id="__codelineno-12-223" name="__codelineno-12-223" href="#__codelineno-12-223"></a>
</span><span id="__span-12-224"><a id="__codelineno-12-224" name="__codelineno-12-224" href="#__codelineno-12-224"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">stats</span><span class="p">)</span>
</span><span id="__span-12-225"><a id="__codelineno-12-225" name="__codelineno-12-225" href="#__codelineno-12-225"></a>
</span><span id="__span-12-226"><a id="__codelineno-12-226" name="__codelineno-12-226" href="#__codelineno-12-226"></a>
</span><span id="__span-12-227"><a id="__codelineno-12-227" name="__codelineno-12-227" href="#__codelineno-12-227"></a><span class="c1"># =============================================================================</span>
</span><span id="__span-12-228"><a id="__codelineno-12-228" name="__codelineno-12-228" href="#__codelineno-12-228"></a><span class="c1"># Containerコンポーネント（状態連携）</span>
</span><span id="__span-12-229"><a id="__codelineno-12-229" name="__codelineno-12-229" href="#__codelineno-12-229"></a><span class="c1"># =============================================================================</span>
</span><span id="__span-12-230"><a id="__codelineno-12-230" name="__codelineno-12-230" href="#__codelineno-12-230"></a>
</span><span id="__span-12-231"><a id="__codelineno-12-231" name="__codelineno-12-231" href="#__codelineno-12-231"></a>
</span><span id="__span-12-232"><a id="__codelineno-12-232" name="__codelineno-12-232" href="#__codelineno-12-232"></a><span class="k">class</span><span class="w"> </span><span class="nc">NavbarContainer</span><span class="p">(</span><span class="n">ContainerComponentTk</span><span class="p">[</span><span class="n">AppState</span><span class="p">]):</span>
</span><span id="__span-12-233"><a id="__codelineno-12-233" name="__codelineno-12-233" href="#__codelineno-12-233"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-234"><a id="__codelineno-12-234" name="__codelineno-12-234" href="#__codelineno-12-234"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="s2">&quot;navy&quot;</span><span class="p">)</span>
</span><span id="__span-12-235"><a id="__codelineno-12-235" name="__codelineno-12-235" href="#__codelineno-12-235"></a>
</span><span id="__span-12-236"><a id="__codelineno-12-236" name="__codelineno-12-236" href="#__codelineno-12-236"></a>        <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
</span><span id="__span-12-237"><a id="__codelineno-12-237" name="__codelineno-12-237" href="#__codelineno-12-237"></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-12-238"><a id="__codelineno-12-238" name="__codelineno-12-238" href="#__codelineno-12-238"></a>            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;🎯 PubSubTk Demo (w/ Undo/Redo)&quot;</span><span class="p">,</span>
</span><span id="__span-12-239"><a id="__codelineno-12-239" name="__codelineno-12-239" href="#__codelineno-12-239"></a>            <span class="n">fg</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span id="__span-12-240"><a id="__codelineno-12-240" name="__codelineno-12-240" href="#__codelineno-12-240"></a>            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;navy&quot;</span><span class="p">,</span>
</span><span id="__span-12-241"><a id="__codelineno-12-241" name="__codelineno-12-241" href="#__codelineno-12-241"></a>            <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="s2">&quot;bold&quot;</span><span class="p">),</span>
</span><span id="__span-12-242"><a id="__codelineno-12-242" name="__codelineno-12-242" href="#__codelineno-12-242"></a>        <span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-12-243"><a id="__codelineno-12-243" name="__codelineno-12-243" href="#__codelineno-12-243"></a>
</span><span id="__span-12-244"><a id="__codelineno-12-244" name="__codelineno-12-244" href="#__codelineno-12-244"></a>        <span class="n">nav_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;navy&quot;</span><span class="p">)</span>
</span><span id="__span-12-245"><a id="__codelineno-12-245" name="__codelineno-12-245" href="#__codelineno-12-245"></a>        <span class="n">nav_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-12-246"><a id="__codelineno-12-246" name="__codelineno-12-246" href="#__codelineno-12-246"></a>
</span><span id="__span-12-247"><a id="__codelineno-12-247" name="__codelineno-12-247" href="#__codelineno-12-247"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">main_btn</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">nav_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;メイン&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_to_main</span><span class="p">)</span>
</span><span id="__span-12-248"><a id="__codelineno-12-248" name="__codelineno-12-248" href="#__codelineno-12-248"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">main_btn</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-12-249"><a id="__codelineno-12-249" name="__codelineno-12-249" href="#__codelineno-12-249"></a>
</span><span id="__span-12-250"><a id="__codelineno-12-250" name="__codelineno-12-250" href="#__codelineno-12-250"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">todo_btn</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">nav_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Todo&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_to_todo</span><span class="p">)</span>
</span><span id="__span-12-251"><a id="__codelineno-12-251" name="__codelineno-12-251" href="#__codelineno-12-251"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">todo_btn</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-12-252"><a id="__codelineno-12-252" name="__codelineno-12-252" href="#__codelineno-12-252"></a>
</span><span id="__span-12-253"><a id="__codelineno-12-253" name="__codelineno-12-253" href="#__codelineno-12-253"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-254"><a id="__codelineno-12-254" name="__codelineno-12-254" href="#__codelineno-12-254"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub_state_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_view</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_view_changed</span><span class="p">)</span>
</span><span id="__span-12-255"><a id="__codelineno-12-255" name="__codelineno-12-255" href="#__codelineno-12-255"></a>
</span><span id="__span-12-256"><a id="__codelineno-12-256" name="__codelineno-12-256" href="#__codelineno-12-256"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_from_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-257"><a id="__codelineno-12-257" name="__codelineno-12-257" href="#__codelineno-12-257"></a>        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">get_current_state</span><span class="p">()</span>
</span><span id="__span-12-258"><a id="__codelineno-12-258" name="__codelineno-12-258" href="#__codelineno-12-258"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_buttons</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">current_view</span><span class="p">)</span>
</span><span id="__span-12-259"><a id="__codelineno-12-259" name="__codelineno-12-259" href="#__codelineno-12-259"></a>
</span><span id="__span-12-260"><a id="__codelineno-12-260" name="__codelineno-12-260" href="#__codelineno-12-260"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_view_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_value</span><span class="p">,</span> <span class="n">new_value</span><span class="p">):</span>
</span><span id="__span-12-261"><a id="__codelineno-12-261" name="__codelineno-12-261" href="#__codelineno-12-261"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_buttons</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span>
</span><span id="__span-12-262"><a id="__codelineno-12-262" name="__codelineno-12-262" href="#__codelineno-12-262"></a>
</span><span id="__span-12-263"><a id="__codelineno-12-263" name="__codelineno-12-263" href="#__codelineno-12-263"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_view</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-12-264"><a id="__codelineno-12-264" name="__codelineno-12-264" href="#__codelineno-12-264"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">main_btn</span><span class="o">.</span><span class="n">config</span><span class="p">(</span>
</span><span id="__span-12-265"><a id="__codelineno-12-265" name="__codelineno-12-265" href="#__codelineno-12-265"></a>            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;lightblue&quot;</span> <span class="k">if</span> <span class="n">current_view</span> <span class="o">==</span> <span class="s2">&quot;main&quot;</span> <span class="k">else</span> <span class="s2">&quot;SystemButtonFace&quot;</span>
</span><span id="__span-12-266"><a id="__codelineno-12-266" name="__codelineno-12-266" href="#__codelineno-12-266"></a>        <span class="p">)</span>
</span><span id="__span-12-267"><a id="__codelineno-12-267" name="__codelineno-12-267" href="#__codelineno-12-267"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">todo_btn</span><span class="o">.</span><span class="n">config</span><span class="p">(</span>
</span><span id="__span-12-268"><a id="__codelineno-12-268" name="__codelineno-12-268" href="#__codelineno-12-268"></a>            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;lightblue&quot;</span> <span class="k">if</span> <span class="n">current_view</span> <span class="o">==</span> <span class="s2">&quot;todo&quot;</span> <span class="k">else</span> <span class="s2">&quot;SystemButtonFace&quot;</span>
</span><span id="__span-12-269"><a id="__codelineno-12-269" name="__codelineno-12-269" href="#__codelineno-12-269"></a>        <span class="p">)</span>
</span><span id="__span-12-270"><a id="__codelineno-12-270" name="__codelineno-12-270" href="#__codelineno-12-270"></a>
</span><span id="__span-12-271"><a id="__codelineno-12-271" name="__codelineno-12-271" href="#__codelineno-12-271"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">switch_to_main</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-272"><a id="__codelineno-12-272" name="__codelineno-12-272" href="#__codelineno-12-272"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_view</span><span class="p">,</span> <span class="s2">&quot;main&quot;</span><span class="p">)</span>
</span><span id="__span-12-273"><a id="__codelineno-12-273" name="__codelineno-12-273" href="#__codelineno-12-273"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_switch_slot</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="n">MainContainer</span><span class="p">)</span>
</span><span id="__span-12-274"><a id="__codelineno-12-274" name="__codelineno-12-274" href="#__codelineno-12-274"></a>
</span><span id="__span-12-275"><a id="__codelineno-12-275" name="__codelineno-12-275" href="#__codelineno-12-275"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">switch_to_todo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-276"><a id="__codelineno-12-276" name="__codelineno-12-276" href="#__codelineno-12-276"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_view</span><span class="p">,</span> <span class="s2">&quot;todo&quot;</span><span class="p">)</span>
</span><span id="__span-12-277"><a id="__codelineno-12-277" name="__codelineno-12-277" href="#__codelineno-12-277"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_switch_slot</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="n">TodoContainer</span><span class="p">)</span>
</span><span id="__span-12-278"><a id="__codelineno-12-278" name="__codelineno-12-278" href="#__codelineno-12-278"></a>
</span><span id="__span-12-279"><a id="__codelineno-12-279" name="__codelineno-12-279" href="#__codelineno-12-279"></a>
</span><span id="__span-12-280"><a id="__codelineno-12-280" name="__codelineno-12-280" href="#__codelineno-12-280"></a><span class="k">class</span><span class="w"> </span><span class="nc">MainContainer</span><span class="p">(</span><span class="n">ContainerComponentTk</span><span class="p">[</span><span class="n">AppState</span><span class="p">]):</span>
</span><span id="__span-12-281"><a id="__codelineno-12-281" name="__codelineno-12-281" href="#__codelineno-12-281"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-282"><a id="__codelineno-12-282" name="__codelineno-12-282" href="#__codelineno-12-282"></a>        <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;🏠 メインビュー&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;bold&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-12-283"><a id="__codelineno-12-283" name="__codelineno-12-283" href="#__codelineno-12-283"></a>
</span><span id="__span-12-284"><a id="__codelineno-12-284" name="__codelineno-12-284" href="#__codelineno-12-284"></a>        <span class="c1"># カウンター</span>
</span><span id="__span-12-285"><a id="__codelineno-12-285" name="__codelineno-12-285" href="#__codelineno-12-285"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">counter_label</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
</span><span id="__span-12-286"><a id="__codelineno-12-286" name="__codelineno-12-286" href="#__codelineno-12-286"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">counter_label</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="__span-12-287"><a id="__codelineno-12-287" name="__codelineno-12-287" href="#__codelineno-12-287"></a>
</span><span id="__span-12-288"><a id="__codelineno-12-288" name="__codelineno-12-288" href="#__codelineno-12-288"></a>        <span class="c1"># Undo/Redoコントロール（カウンター用）</span>
</span><span id="__span-12-289"><a id="__codelineno-12-289" name="__codelineno-12-289" href="#__codelineno-12-289"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">counter_undo_control</span> <span class="o">=</span> <span class="n">UndoRedoControlView</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-12-290"><a id="__codelineno-12-290" name="__codelineno-12-290" href="#__codelineno-12-290"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">counter_undo_control</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-12-291"><a id="__codelineno-12-291" name="__codelineno-12-291" href="#__codelineno-12-291"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">counter_undo_control</span><span class="o">.</span><span class="n">setup_handlers</span><span class="p">(</span>
</span><span id="__span-12-292"><a id="__codelineno-12-292" name="__codelineno-12-292" href="#__codelineno-12-292"></a>            <span class="n">undo_handler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">undo_counter</span><span class="p">,</span> <span class="n">redo_handler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">redo_counter</span>
</span><span id="__span-12-293"><a id="__codelineno-12-293" name="__codelineno-12-293" href="#__codelineno-12-293"></a>        <span class="p">)</span>
</span><span id="__span-12-294"><a id="__codelineno-12-294" name="__codelineno-12-294" href="#__codelineno-12-294"></a>
</span><span id="__span-12-295"><a id="__codelineno-12-295" name="__codelineno-12-295" href="#__codelineno-12-295"></a>        <span class="c1"># ボタン群</span>
</span><span id="__span-12-296"><a id="__codelineno-12-296" name="__codelineno-12-296" href="#__codelineno-12-296"></a>        <span class="n">btn_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-12-297"><a id="__codelineno-12-297" name="__codelineno-12-297" href="#__codelineno-12-297"></a>        <span class="n">btn_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-12-298"><a id="__codelineno-12-298" name="__codelineno-12-298" href="#__codelineno-12-298"></a>
</span><span id="__span-12-299"><a id="__codelineno-12-299" name="__codelineno-12-299" href="#__codelineno-12-299"></a>        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">btn_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;カウント&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">increment</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
</span><span id="__span-12-300"><a id="__codelineno-12-300" name="__codelineno-12-300" href="#__codelineno-12-300"></a>            <span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span>
</span><span id="__span-12-301"><a id="__codelineno-12-301" name="__codelineno-12-301" href="#__codelineno-12-301"></a>        <span class="p">)</span>
</span><span id="__span-12-302"><a id="__codelineno-12-302" name="__codelineno-12-302" href="#__codelineno-12-302"></a>        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">btn_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;リセット&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
</span><span id="__span-12-303"><a id="__codelineno-12-303" name="__codelineno-12-303" href="#__codelineno-12-303"></a>            <span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span>
</span><span id="__span-12-304"><a id="__codelineno-12-304" name="__codelineno-12-304" href="#__codelineno-12-304"></a>        <span class="p">)</span>
</span><span id="__span-12-305"><a id="__codelineno-12-305" name="__codelineno-12-305" href="#__codelineno-12-305"></a>        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">btn_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;サブウィンドウ&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">open_sub</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
</span><span id="__span-12-306"><a id="__codelineno-12-306" name="__codelineno-12-306" href="#__codelineno-12-306"></a>            <span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span>
</span><span id="__span-12-307"><a id="__codelineno-12-307" name="__codelineno-12-307" href="#__codelineno-12-307"></a>        <span class="p">)</span>
</span><span id="__span-12-308"><a id="__codelineno-12-308" name="__codelineno-12-308" href="#__codelineno-12-308"></a>
</span><span id="__span-12-309"><a id="__codelineno-12-309" name="__codelineno-12-309" href="#__codelineno-12-309"></a>        <span class="c1"># Undo/Redo制御ボタン</span>
</span><span id="__span-12-310"><a id="__codelineno-12-310" name="__codelineno-12-310" href="#__codelineno-12-310"></a>        <span class="n">undo_control_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-12-311"><a id="__codelineno-12-311" name="__codelineno-12-311" href="#__codelineno-12-311"></a>        <span class="n">undo_control_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-12-312"><a id="__codelineno-12-312" name="__codelineno-12-312" href="#__codelineno-12-312"></a>
</span><span id="__span-12-313"><a id="__codelineno-12-313" name="__codelineno-12-313" href="#__codelineno-12-313"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_undo_btn</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
</span><span id="__span-12-314"><a id="__codelineno-12-314" name="__codelineno-12-314" href="#__codelineno-12-314"></a>            <span class="n">undo_control_frame</span><span class="p">,</span>
</span><span id="__span-12-315"><a id="__codelineno-12-315" name="__codelineno-12-315" href="#__codelineno-12-315"></a>            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;履歴記録ON&quot;</span><span class="p">,</span>
</span><span id="__span-12-316"><a id="__codelineno-12-316" name="__codelineno-12-316" href="#__codelineno-12-316"></a>            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">enable_counter_undo</span><span class="p">,</span>
</span><span id="__span-12-317"><a id="__codelineno-12-317" name="__codelineno-12-317" href="#__codelineno-12-317"></a>            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;lightgreen&quot;</span><span class="p">,</span>
</span><span id="__span-12-318"><a id="__codelineno-12-318" name="__codelineno-12-318" href="#__codelineno-12-318"></a>        <span class="p">)</span>
</span><span id="__span-12-319"><a id="__codelineno-12-319" name="__codelineno-12-319" href="#__codelineno-12-319"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_undo_btn</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-12-320"><a id="__codelineno-12-320" name="__codelineno-12-320" href="#__codelineno-12-320"></a>
</span><span id="__span-12-321"><a id="__codelineno-12-321" name="__codelineno-12-321" href="#__codelineno-12-321"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">disable_undo_btn</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
</span><span id="__span-12-322"><a id="__codelineno-12-322" name="__codelineno-12-322" href="#__codelineno-12-322"></a>            <span class="n">undo_control_frame</span><span class="p">,</span>
</span><span id="__span-12-323"><a id="__codelineno-12-323" name="__codelineno-12-323" href="#__codelineno-12-323"></a>            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;履歴記録OFF&quot;</span><span class="p">,</span>
</span><span id="__span-12-324"><a id="__codelineno-12-324" name="__codelineno-12-324" href="#__codelineno-12-324"></a>            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">disable_counter_undo</span><span class="p">,</span>
</span><span id="__span-12-325"><a id="__codelineno-12-325" name="__codelineno-12-325" href="#__codelineno-12-325"></a>            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;lightcoral&quot;</span><span class="p">,</span>
</span><span id="__span-12-326"><a id="__codelineno-12-326" name="__codelineno-12-326" href="#__codelineno-12-326"></a>            <span class="n">state</span><span class="o">=</span><span class="s2">&quot;disabled&quot;</span><span class="p">,</span>
</span><span id="__span-12-327"><a id="__codelineno-12-327" name="__codelineno-12-327" href="#__codelineno-12-327"></a>        <span class="p">)</span>
</span><span id="__span-12-328"><a id="__codelineno-12-328" name="__codelineno-12-328" href="#__codelineno-12-328"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">disable_undo_btn</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-12-329"><a id="__codelineno-12-329" name="__codelineno-12-329" href="#__codelineno-12-329"></a>
</span><span id="__span-12-330"><a id="__codelineno-12-330" name="__codelineno-12-330" href="#__codelineno-12-330"></a>        <span class="c1"># ファイル操作</span>
</span><span id="__span-12-331"><a id="__codelineno-12-331" name="__codelineno-12-331" href="#__codelineno-12-331"></a>        <span class="n">file_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-12-332"><a id="__codelineno-12-332" name="__codelineno-12-332" href="#__codelineno-12-332"></a>        <span class="n">file_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-12-333"><a id="__codelineno-12-333" name="__codelineno-12-333" href="#__codelineno-12-333"></a>
</span><span id="__span-12-334"><a id="__codelineno-12-334" name="__codelineno-12-334" href="#__codelineno-12-334"></a>        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">file_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;保存&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
</span><span id="__span-12-335"><a id="__codelineno-12-335" name="__codelineno-12-335" href="#__codelineno-12-335"></a>            <span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span>
</span><span id="__span-12-336"><a id="__codelineno-12-336" name="__codelineno-12-336" href="#__codelineno-12-336"></a>        <span class="p">)</span>
</span><span id="__span-12-337"><a id="__codelineno-12-337" name="__codelineno-12-337" href="#__codelineno-12-337"></a>        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">file_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;読込&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
</span><span id="__span-12-338"><a id="__codelineno-12-338" name="__codelineno-12-338" href="#__codelineno-12-338"></a>            <span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span>
</span><span id="__span-12-339"><a id="__codelineno-12-339" name="__codelineno-12-339" href="#__codelineno-12-339"></a>        <span class="p">)</span>
</span><span id="__span-12-340"><a id="__codelineno-12-340" name="__codelineno-12-340" href="#__codelineno-12-340"></a>
</span><span id="__span-12-341"><a id="__codelineno-12-341" name="__codelineno-12-341" href="#__codelineno-12-341"></a>        <span class="c1"># 設定操作（辞書機能テスト）</span>
</span><span id="__span-12-342"><a id="__codelineno-12-342" name="__codelineno-12-342" href="#__codelineno-12-342"></a>        <span class="n">setting_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-12-343"><a id="__codelineno-12-343" name="__codelineno-12-343" href="#__codelineno-12-343"></a>        <span class="n">setting_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-12-344"><a id="__codelineno-12-344" name="__codelineno-12-344" href="#__codelineno-12-344"></a>
</span><span id="__span-12-345"><a id="__codelineno-12-345" name="__codelineno-12-345" href="#__codelineno-12-345"></a>        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">setting_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;設定追加&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">add_setting</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
</span><span id="__span-12-346"><a id="__codelineno-12-346" name="__codelineno-12-346" href="#__codelineno-12-346"></a>            <span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span>
</span><span id="__span-12-347"><a id="__codelineno-12-347" name="__codelineno-12-347" href="#__codelineno-12-347"></a>        <span class="p">)</span>
</span><span id="__span-12-348"><a id="__codelineno-12-348" name="__codelineno-12-348" href="#__codelineno-12-348"></a>        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
</span><span id="__span-12-349"><a id="__codelineno-12-349" name="__codelineno-12-349" href="#__codelineno-12-349"></a>            <span class="n">setting_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;プロセッサー追加&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">add_processor</span>
</span><span id="__span-12-350"><a id="__codelineno-12-350" name="__codelineno-12-350" href="#__codelineno-12-350"></a>        <span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-12-351"><a id="__codelineno-12-351" name="__codelineno-12-351" href="#__codelineno-12-351"></a>
</span><span id="__span-12-352"><a id="__codelineno-12-352" name="__codelineno-12-352" href="#__codelineno-12-352"></a>        <span class="c1"># 危険な操作</span>
</span><span id="__span-12-353"><a id="__codelineno-12-353" name="__codelineno-12-353" href="#__codelineno-12-353"></a>        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
</span><span id="__span-12-354"><a id="__codelineno-12-354" name="__codelineno-12-354" href="#__codelineno-12-354"></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;全状態リセット&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reset_all</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s2">&quot;white&quot;</span>
</span><span id="__span-12-355"><a id="__codelineno-12-355" name="__codelineno-12-355" href="#__codelineno-12-355"></a>        <span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-12-356"><a id="__codelineno-12-356" name="__codelineno-12-356" href="#__codelineno-12-356"></a>
</span><span id="__span-12-357"><a id="__codelineno-12-357" name="__codelineno-12-357" href="#__codelineno-12-357"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-358"><a id="__codelineno-12-358" name="__codelineno-12-358" href="#__codelineno-12-358"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub_state_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_counter_changed</span><span class="p">)</span>
</span><span id="__span-12-359"><a id="__codelineno-12-359" name="__codelineno-12-359" href="#__codelineno-12-359"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">AppTopic</span><span class="o">.</span><span class="n">MILESTONE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_milestone</span><span class="p">)</span>
</span><span id="__span-12-360"><a id="__codelineno-12-360" name="__codelineno-12-360" href="#__codelineno-12-360"></a>
</span><span id="__span-12-361"><a id="__codelineno-12-361" name="__codelineno-12-361" href="#__codelineno-12-361"></a>        <span class="c1"># カウンターのUndo/Redoステータス変化を購読</span>
</span><span id="__span-12-362"><a id="__codelineno-12-362" name="__codelineno-12-362" href="#__codelineno-12-362"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub_undo_status</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_counter_undo_status</span><span class="p">)</span>
</span><span id="__span-12-363"><a id="__codelineno-12-363" name="__codelineno-12-363" href="#__codelineno-12-363"></a>
</span><span id="__span-12-364"><a id="__codelineno-12-364" name="__codelineno-12-364" href="#__codelineno-12-364"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_from_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-365"><a id="__codelineno-12-365" name="__codelineno-12-365" href="#__codelineno-12-365"></a>        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">get_current_state</span><span class="p">()</span>
</span><span id="__span-12-366"><a id="__codelineno-12-366" name="__codelineno-12-366" href="#__codelineno-12-366"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">counter_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="p">))</span>
</span><span id="__span-12-367"><a id="__codelineno-12-367" name="__codelineno-12-367" href="#__codelineno-12-367"></a>
</span><span id="__span-12-368"><a id="__codelineno-12-368" name="__codelineno-12-368" href="#__codelineno-12-368"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_counter_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_value</span><span class="p">,</span> <span class="n">new_value</span><span class="p">):</span>
</span><span id="__span-12-369"><a id="__codelineno-12-369" name="__codelineno-12-369" href="#__codelineno-12-369"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">counter_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">new_value</span><span class="p">))</span>
</span><span id="__span-12-370"><a id="__codelineno-12-370" name="__codelineno-12-370" href="#__codelineno-12-370"></a>
</span><span id="__span-12-371"><a id="__codelineno-12-371" name="__codelineno-12-371" href="#__codelineno-12-371"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_counter_undo_status</span><span class="p">(</span>
</span><span id="__span-12-372"><a id="__codelineno-12-372" name="__codelineno-12-372" href="#__codelineno-12-372"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">can_undo</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">can_redo</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">undo_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">redo_count</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-12-373"><a id="__codelineno-12-373" name="__codelineno-12-373" href="#__codelineno-12-373"></a>    <span class="p">):</span>
</span><span id="__span-12-374"><a id="__codelineno-12-374" name="__codelineno-12-374" href="#__codelineno-12-374"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;カウンターのUndo/Redoステータス変化ハンドラー&quot;&quot;&quot;</span>
</span><span id="__span-12-375"><a id="__codelineno-12-375" name="__codelineno-12-375" href="#__codelineno-12-375"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">counter_undo_control</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span>
</span><span id="__span-12-376"><a id="__codelineno-12-376" name="__codelineno-12-376" href="#__codelineno-12-376"></a>            <span class="n">can_undo</span><span class="p">,</span> <span class="n">can_redo</span><span class="p">,</span> <span class="n">undo_count</span><span class="p">,</span> <span class="n">redo_count</span>
</span><span id="__span-12-377"><a id="__codelineno-12-377" name="__codelineno-12-377" href="#__codelineno-12-377"></a>        <span class="p">)</span>
</span><span id="__span-12-378"><a id="__codelineno-12-378" name="__codelineno-12-378" href="#__codelineno-12-378"></a>
</span><span id="__span-12-379"><a id="__codelineno-12-379" name="__codelineno-12-379" href="#__codelineno-12-379"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">enable_counter_undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-380"><a id="__codelineno-12-380" name="__codelineno-12-380" href="#__codelineno-12-380"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;カウンターのUndo/Redo機能を有効化&quot;&quot;&quot;</span>
</span><span id="__span-12-381"><a id="__codelineno-12-381" name="__codelineno-12-381" href="#__codelineno-12-381"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_enable_undo_redo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="p">),</span> <span class="n">max_history</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="__span-12-382"><a id="__codelineno-12-382" name="__codelineno-12-382" href="#__codelineno-12-382"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_undo_btn</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s2">&quot;disabled&quot;</span><span class="p">)</span>
</span><span id="__span-12-383"><a id="__codelineno-12-383" name="__codelineno-12-383" href="#__codelineno-12-383"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">disable_undo_btn</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">)</span>
</span><span id="__span-12-384"><a id="__codelineno-12-384" name="__codelineno-12-384" href="#__codelineno-12-384"></a>
</span><span id="__span-12-385"><a id="__codelineno-12-385" name="__codelineno-12-385" href="#__codelineno-12-385"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">disable_counter_undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-386"><a id="__codelineno-12-386" name="__codelineno-12-386" href="#__codelineno-12-386"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;カウンターのUndo/Redo機能を無効化&quot;&quot;&quot;</span>
</span><span id="__span-12-387"><a id="__codelineno-12-387" name="__codelineno-12-387" href="#__codelineno-12-387"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_disable_undo_redo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="p">))</span>
</span><span id="__span-12-388"><a id="__codelineno-12-388" name="__codelineno-12-388" href="#__codelineno-12-388"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_undo_btn</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">)</span>
</span><span id="__span-12-389"><a id="__codelineno-12-389" name="__codelineno-12-389" href="#__codelineno-12-389"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">disable_undo_btn</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s2">&quot;disabled&quot;</span><span class="p">)</span>
</span><span id="__span-12-390"><a id="__codelineno-12-390" name="__codelineno-12-390" href="#__codelineno-12-390"></a>
</span><span id="__span-12-391"><a id="__codelineno-12-391" name="__codelineno-12-391" href="#__codelineno-12-391"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">undo_counter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-392"><a id="__codelineno-12-392" name="__codelineno-12-392" href="#__codelineno-12-392"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;カウンターをUndo&quot;&quot;&quot;</span>
</span><span id="__span-12-393"><a id="__codelineno-12-393" name="__codelineno-12-393" href="#__codelineno-12-393"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_undo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="p">))</span>
</span><span id="__span-12-394"><a id="__codelineno-12-394" name="__codelineno-12-394" href="#__codelineno-12-394"></a>
</span><span id="__span-12-395"><a id="__codelineno-12-395" name="__codelineno-12-395" href="#__codelineno-12-395"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">redo_counter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-396"><a id="__codelineno-12-396" name="__codelineno-12-396" href="#__codelineno-12-396"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;カウンターをRedo&quot;&quot;&quot;</span>
</span><span id="__span-12-397"><a id="__codelineno-12-397" name="__codelineno-12-397" href="#__codelineno-12-397"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_redo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="p">))</span>
</span><span id="__span-12-398"><a id="__codelineno-12-398" name="__codelineno-12-398" href="#__codelineno-12-398"></a>
</span><span id="__span-12-399"><a id="__codelineno-12-399" name="__codelineno-12-399" href="#__codelineno-12-399"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">increment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-400"><a id="__codelineno-12-400" name="__codelineno-12-400" href="#__codelineno-12-400"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">AppTopic</span><span class="o">.</span><span class="n">INCREMENT</span><span class="p">)</span>
</span><span id="__span-12-401"><a id="__codelineno-12-401" name="__codelineno-12-401" href="#__codelineno-12-401"></a>
</span><span id="__span-12-402"><a id="__codelineno-12-402" name="__codelineno-12-402" href="#__codelineno-12-402"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-403"><a id="__codelineno-12-403" name="__codelineno-12-403" href="#__codelineno-12-403"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">AppTopic</span><span class="o">.</span><span class="n">RESET</span><span class="p">)</span>
</span><span id="__span-12-404"><a id="__codelineno-12-404" name="__codelineno-12-404" href="#__codelineno-12-404"></a>
</span><span id="__span-12-405"><a id="__codelineno-12-405" name="__codelineno-12-405" href="#__codelineno-12-405"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">open_sub</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-406"><a id="__codelineno-12-406" name="__codelineno-12-406" href="#__codelineno-12-406"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_open_subwindow</span><span class="p">(</span><span class="n">SubWindow</span><span class="p">)</span>
</span><span id="__span-12-407"><a id="__codelineno-12-407" name="__codelineno-12-407" href="#__codelineno-12-407"></a>
</span><span id="__span-12-408"><a id="__codelineno-12-408" name="__codelineno-12-408" href="#__codelineno-12-408"></a>    <span class="nd">@make_async_task</span>
</span><span id="__span-12-409"><a id="__codelineno-12-409" name="__codelineno-12-409" href="#__codelineno-12-409"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">save_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-410"><a id="__codelineno-12-410" name="__codelineno-12-410" href="#__codelineno-12-410"></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">asksaveasfilename</span><span class="p">(</span><span class="n">defaultextension</span><span class="o">=</span><span class="s2">&quot;.json&quot;</span><span class="p">)</span>
</span><span id="__span-12-411"><a id="__codelineno-12-411" name="__codelineno-12-411" href="#__codelineno-12-411"></a>        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="__span-12-412"><a id="__codelineno-12-412" name="__codelineno-12-412" href="#__codelineno-12-412"></a>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>  <span class="c1"># 保存処理シミュレート</span>
</span><span id="__span-12-413"><a id="__codelineno-12-413" name="__codelineno-12-413" href="#__codelineno-12-413"></a>            <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">get_current_state</span><span class="p">()</span>
</span><span id="__span-12-414"><a id="__codelineno-12-414" name="__codelineno-12-414" href="#__codelineno-12-414"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-12-415"><a id="__codelineno-12-415" name="__codelineno-12-415" href="#__codelineno-12-415"></a>                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-12-416"><a id="__codelineno-12-416" name="__codelineno-12-416" href="#__codelineno-12-416"></a>            <span class="n">messagebox</span><span class="o">.</span><span class="n">showinfo</span><span class="p">(</span><span class="s2">&quot;完了&quot;</span><span class="p">,</span> <span class="s2">&quot;データを保存しました&quot;</span><span class="p">)</span>
</span><span id="__span-12-417"><a id="__codelineno-12-417" name="__codelineno-12-417" href="#__codelineno-12-417"></a>
</span><span id="__span-12-418"><a id="__codelineno-12-418" name="__codelineno-12-418" href="#__codelineno-12-418"></a>    <span class="nd">@make_async_task</span>
</span><span id="__span-12-419"><a id="__codelineno-12-419" name="__codelineno-12-419" href="#__codelineno-12-419"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-420"><a id="__codelineno-12-420" name="__codelineno-12-420" href="#__codelineno-12-420"></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">filetypes</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;JSON files&quot;</span><span class="p">,</span> <span class="s2">&quot;*.json&quot;</span><span class="p">)])</span>
</span><span id="__span-12-421"><a id="__codelineno-12-421" name="__codelineno-12-421" href="#__codelineno-12-421"></a>        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
</span><span id="__span-12-422"><a id="__codelineno-12-422" name="__codelineno-12-422" href="#__codelineno-12-422"></a>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>  <span class="c1"># 読込処理シミュレート</span>
</span><span id="__span-12-423"><a id="__codelineno-12-423" name="__codelineno-12-423" href="#__codelineno-12-423"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-12-424"><a id="__codelineno-12-424" name="__codelineno-12-424" href="#__codelineno-12-424"></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-12-425"><a id="__codelineno-12-425" name="__codelineno-12-425" href="#__codelineno-12-425"></a>            <span class="n">new_state</span> <span class="o">=</span> <span class="n">AppState</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-12-426"><a id="__codelineno-12-426" name="__codelineno-12-426" href="#__codelineno-12-426"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pub_replace_state</span><span class="p">(</span><span class="n">new_state</span><span class="p">)</span>
</span><span id="__span-12-427"><a id="__codelineno-12-427" name="__codelineno-12-427" href="#__codelineno-12-427"></a>            <span class="c1"># 状態リセット後は画面も適切に切り替える</span>
</span><span id="__span-12-428"><a id="__codelineno-12-428" name="__codelineno-12-428" href="#__codelineno-12-428"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pub_switch_slot</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="n">MainContainer</span><span class="p">)</span>
</span><span id="__span-12-429"><a id="__codelineno-12-429" name="__codelineno-12-429" href="#__codelineno-12-429"></a>            <span class="n">messagebox</span><span class="o">.</span><span class="n">showinfo</span><span class="p">(</span><span class="s2">&quot;完了&quot;</span><span class="p">,</span> <span class="s2">&quot;データを読み込みました&quot;</span><span class="p">)</span>
</span><span id="__span-12-430"><a id="__codelineno-12-430" name="__codelineno-12-430" href="#__codelineno-12-430"></a>
</span><span id="__span-12-431"><a id="__codelineno-12-431" name="__codelineno-12-431" href="#__codelineno-12-431"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_setting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-432"><a id="__codelineno-12-432" name="__codelineno-12-432" href="#__codelineno-12-432"></a>        <span class="n">key</span> <span class="o">=</span> <span class="n">simpledialog</span><span class="o">.</span><span class="n">askstring</span><span class="p">(</span><span class="s2">&quot;設定追加&quot;</span><span class="p">,</span> <span class="s2">&quot;キーを入力:&quot;</span><span class="p">)</span>
</span><span id="__span-12-433"><a id="__codelineno-12-433" name="__codelineno-12-433" href="#__codelineno-12-433"></a>        <span class="k">if</span> <span class="n">key</span><span class="p">:</span>
</span><span id="__span-12-434"><a id="__codelineno-12-434" name="__codelineno-12-434" href="#__codelineno-12-434"></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">simpledialog</span><span class="o">.</span><span class="n">askstring</span><span class="p">(</span><span class="s2">&quot;設定追加&quot;</span><span class="p">,</span> <span class="s2">&quot;値を入力:&quot;</span><span class="p">)</span>
</span><span id="__span-12-435"><a id="__codelineno-12-435" name="__codelineno-12-435" href="#__codelineno-12-435"></a>            <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
</span><span id="__span-12-436"><a id="__codelineno-12-436" name="__codelineno-12-436" href="#__codelineno-12-436"></a>                <span class="c1"># pub_add_to_dict使用</span>
</span><span id="__span-12-437"><a id="__codelineno-12-437" name="__codelineno-12-437" href="#__codelineno-12-437"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pub_add_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">settings</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="__span-12-438"><a id="__codelineno-12-438" name="__codelineno-12-438" href="#__codelineno-12-438"></a>
</span><span id="__span-12-439"><a id="__codelineno-12-439" name="__codelineno-12-439" href="#__codelineno-12-439"></a>    <span class="nd">@make_async_task</span>
</span><span id="__span-12-440"><a id="__codelineno-12-440" name="__codelineno-12-440" href="#__codelineno-12-440"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">add_processor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-441"><a id="__codelineno-12-441" name="__codelineno-12-441" href="#__codelineno-12-441"></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># プロセッサー初期化シミュレート</span>
</span><span id="__span-12-442"><a id="__codelineno-12-442" name="__codelineno-12-442" href="#__codelineno-12-442"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-12-443"><a id="__codelineno-12-443" name="__codelineno-12-443" href="#__codelineno-12-443"></a>            <span class="c1"># pub_register_processor使用</span>
</span><span id="__span-12-444"><a id="__codelineno-12-444" name="__codelineno-12-444" href="#__codelineno-12-444"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pub_register_processor</span><span class="p">(</span><span class="n">DummyProcessor</span><span class="p">,</span> <span class="s2">&quot;dummy&quot;</span><span class="p">)</span>
</span><span id="__span-12-445"><a id="__codelineno-12-445" name="__codelineno-12-445" href="#__codelineno-12-445"></a>            <span class="n">messagebox</span><span class="o">.</span><span class="n">showinfo</span><span class="p">(</span><span class="s2">&quot;成功&quot;</span><span class="p">,</span> <span class="s2">&quot;プロセッサーを追加しました&quot;</span><span class="p">)</span>
</span><span id="__span-12-446"><a id="__codelineno-12-446" name="__codelineno-12-446" href="#__codelineno-12-446"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-12-447"><a id="__codelineno-12-447" name="__codelineno-12-447" href="#__codelineno-12-447"></a>            <span class="n">messagebox</span><span class="o">.</span><span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;エラー&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="__span-12-448"><a id="__codelineno-12-448" name="__codelineno-12-448" href="#__codelineno-12-448"></a>
</span><span id="__span-12-449"><a id="__codelineno-12-449" name="__codelineno-12-449" href="#__codelineno-12-449"></a>    <span class="nd">@make_async_task</span>
</span><span id="__span-12-450"><a id="__codelineno-12-450" name="__codelineno-12-450" href="#__codelineno-12-450"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">reset_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-451"><a id="__codelineno-12-451" name="__codelineno-12-451" href="#__codelineno-12-451"></a>        <span class="k">if</span> <span class="n">messagebox</span><span class="o">.</span><span class="n">askyesno</span><span class="p">(</span><span class="s2">&quot;確認&quot;</span><span class="p">,</span> <span class="s2">&quot;全状態をリセットしますか？&quot;</span><span class="p">):</span>
</span><span id="__span-12-452"><a id="__codelineno-12-452" name="__codelineno-12-452" href="#__codelineno-12-452"></a>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># 重い処理シミュレート</span>
</span><span id="__span-12-453"><a id="__codelineno-12-453" name="__codelineno-12-453" href="#__codelineno-12-453"></a>            <span class="c1"># pub_replace_state使用</span>
</span><span id="__span-12-454"><a id="__codelineno-12-454" name="__codelineno-12-454" href="#__codelineno-12-454"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pub_replace_state</span><span class="p">(</span><span class="n">AppState</span><span class="p">())</span>
</span><span id="__span-12-455"><a id="__codelineno-12-455" name="__codelineno-12-455" href="#__codelineno-12-455"></a>            <span class="c1"># リセット後はメイン画面に戻る</span>
</span><span id="__span-12-456"><a id="__codelineno-12-456" name="__codelineno-12-456" href="#__codelineno-12-456"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pub_switch_slot</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="n">MainContainer</span><span class="p">)</span>
</span><span id="__span-12-457"><a id="__codelineno-12-457" name="__codelineno-12-457" href="#__codelineno-12-457"></a>            <span class="n">messagebox</span><span class="o">.</span><span class="n">showinfo</span><span class="p">(</span><span class="s2">&quot;完了&quot;</span><span class="p">,</span> <span class="s2">&quot;状態をリセットしました&quot;</span><span class="p">)</span>
</span><span id="__span-12-458"><a id="__codelineno-12-458" name="__codelineno-12-458" href="#__codelineno-12-458"></a>
</span><span id="__span-12-459"><a id="__codelineno-12-459" name="__codelineno-12-459" href="#__codelineno-12-459"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_milestone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-12-460"><a id="__codelineno-12-460" name="__codelineno-12-460" href="#__codelineno-12-460"></a>        <span class="n">messagebox</span><span class="o">.</span><span class="n">showinfo</span><span class="p">(</span><span class="s2">&quot;マイルストーン!&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">に到達！&quot;</span><span class="p">)</span>
</span><span id="__span-12-461"><a id="__codelineno-12-461" name="__codelineno-12-461" href="#__codelineno-12-461"></a>
</span><span id="__span-12-462"><a id="__codelineno-12-462" name="__codelineno-12-462" href="#__codelineno-12-462"></a>
</span><span id="__span-12-463"><a id="__codelineno-12-463" name="__codelineno-12-463" href="#__codelineno-12-463"></a><span class="k">class</span><span class="w"> </span><span class="nc">TodoContainer</span><span class="p">(</span><span class="n">ContainerComponentTk</span><span class="p">[</span><span class="n">AppState</span><span class="p">]):</span>
</span><span id="__span-12-464"><a id="__codelineno-12-464" name="__codelineno-12-464" href="#__codelineno-12-464"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-465"><a id="__codelineno-12-465" name="__codelineno-12-465" href="#__codelineno-12-465"></a>        <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;📝 Todo管理&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;bold&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-12-466"><a id="__codelineno-12-466" name="__codelineno-12-466" href="#__codelineno-12-466"></a>
</span><span id="__span-12-467"><a id="__codelineno-12-467" name="__codelineno-12-467" href="#__codelineno-12-467"></a>        <span class="c1"># Todo用Undo/Redoコントロール</span>
</span><span id="__span-12-468"><a id="__codelineno-12-468" name="__codelineno-12-468" href="#__codelineno-12-468"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">todo_undo_control</span> <span class="o">=</span> <span class="n">UndoRedoControlView</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-12-469"><a id="__codelineno-12-469" name="__codelineno-12-469" href="#__codelineno-12-469"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">todo_undo_control</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-12-470"><a id="__codelineno-12-470" name="__codelineno-12-470" href="#__codelineno-12-470"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">todo_undo_control</span><span class="o">.</span><span class="n">setup_handlers</span><span class="p">(</span>
</span><span id="__span-12-471"><a id="__codelineno-12-471" name="__codelineno-12-471" href="#__codelineno-12-471"></a>            <span class="n">undo_handler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">undo_todos</span><span class="p">,</span> <span class="n">redo_handler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">redo_todos</span>
</span><span id="__span-12-472"><a id="__codelineno-12-472" name="__codelineno-12-472" href="#__codelineno-12-472"></a>        <span class="p">)</span>
</span><span id="__span-12-473"><a id="__codelineno-12-473" name="__codelineno-12-473" href="#__codelineno-12-473"></a>
</span><span id="__span-12-474"><a id="__codelineno-12-474" name="__codelineno-12-474" href="#__codelineno-12-474"></a>        <span class="c1"># Undo/Redo制御</span>
</span><span id="__span-12-475"><a id="__codelineno-12-475" name="__codelineno-12-475" href="#__codelineno-12-475"></a>        <span class="n">undo_control_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-12-476"><a id="__codelineno-12-476" name="__codelineno-12-476" href="#__codelineno-12-476"></a>        <span class="n">undo_control_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-12-477"><a id="__codelineno-12-477" name="__codelineno-12-477" href="#__codelineno-12-477"></a>
</span><span id="__span-12-478"><a id="__codelineno-12-478" name="__codelineno-12-478" href="#__codelineno-12-478"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_todo_undo_btn</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
</span><span id="__span-12-479"><a id="__codelineno-12-479" name="__codelineno-12-479" href="#__codelineno-12-479"></a>            <span class="n">undo_control_frame</span><span class="p">,</span>
</span><span id="__span-12-480"><a id="__codelineno-12-480" name="__codelineno-12-480" href="#__codelineno-12-480"></a>            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Todo履歴ON&quot;</span><span class="p">,</span>
</span><span id="__span-12-481"><a id="__codelineno-12-481" name="__codelineno-12-481" href="#__codelineno-12-481"></a>            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">enable_todo_undo</span><span class="p">,</span>
</span><span id="__span-12-482"><a id="__codelineno-12-482" name="__codelineno-12-482" href="#__codelineno-12-482"></a>            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;lightgreen&quot;</span><span class="p">,</span>
</span><span id="__span-12-483"><a id="__codelineno-12-483" name="__codelineno-12-483" href="#__codelineno-12-483"></a>        <span class="p">)</span>
</span><span id="__span-12-484"><a id="__codelineno-12-484" name="__codelineno-12-484" href="#__codelineno-12-484"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_todo_undo_btn</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-12-485"><a id="__codelineno-12-485" name="__codelineno-12-485" href="#__codelineno-12-485"></a>
</span><span id="__span-12-486"><a id="__codelineno-12-486" name="__codelineno-12-486" href="#__codelineno-12-486"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">disable_todo_undo_btn</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
</span><span id="__span-12-487"><a id="__codelineno-12-487" name="__codelineno-12-487" href="#__codelineno-12-487"></a>            <span class="n">undo_control_frame</span><span class="p">,</span>
</span><span id="__span-12-488"><a id="__codelineno-12-488" name="__codelineno-12-488" href="#__codelineno-12-488"></a>            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Todo履歴OFF&quot;</span><span class="p">,</span>
</span><span id="__span-12-489"><a id="__codelineno-12-489" name="__codelineno-12-489" href="#__codelineno-12-489"></a>            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">disable_todo_undo</span><span class="p">,</span>
</span><span id="__span-12-490"><a id="__codelineno-12-490" name="__codelineno-12-490" href="#__codelineno-12-490"></a>            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;lightcoral&quot;</span><span class="p">,</span>
</span><span id="__span-12-491"><a id="__codelineno-12-491" name="__codelineno-12-491" href="#__codelineno-12-491"></a>            <span class="n">state</span><span class="o">=</span><span class="s2">&quot;disabled&quot;</span><span class="p">,</span>
</span><span id="__span-12-492"><a id="__codelineno-12-492" name="__codelineno-12-492" href="#__codelineno-12-492"></a>        <span class="p">)</span>
</span><span id="__span-12-493"><a id="__codelineno-12-493" name="__codelineno-12-493" href="#__codelineno-12-493"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">disable_todo_undo_btn</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-12-494"><a id="__codelineno-12-494" name="__codelineno-12-494" href="#__codelineno-12-494"></a>
</span><span id="__span-12-495"><a id="__codelineno-12-495" name="__codelineno-12-495" href="#__codelineno-12-495"></a>        <span class="c1"># Todo追加</span>
</span><span id="__span-12-496"><a id="__codelineno-12-496" name="__codelineno-12-496" href="#__codelineno-12-496"></a>        <span class="n">add_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-12-497"><a id="__codelineno-12-497" name="__codelineno-12-497" href="#__codelineno-12-497"></a>        <span class="n">add_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-12-498"><a id="__codelineno-12-498" name="__codelineno-12-498" href="#__codelineno-12-498"></a>
</span><span id="__span-12-499"><a id="__codelineno-12-499" name="__codelineno-12-499" href="#__codelineno-12-499"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">entry</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">add_frame</span><span class="p">)</span>
</span><span id="__span-12-500"><a id="__codelineno-12-500" name="__codelineno-12-500" href="#__codelineno-12-500"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">entry</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-12-501"><a id="__codelineno-12-501" name="__codelineno-12-501" href="#__codelineno-12-501"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">entry</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Return&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_todo</span><span class="p">())</span>
</span><span id="__span-12-502"><a id="__codelineno-12-502" name="__codelineno-12-502" href="#__codelineno-12-502"></a>
</span><span id="__span-12-503"><a id="__codelineno-12-503" name="__codelineno-12-503" href="#__codelineno-12-503"></a>        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">add_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;追加&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">add_todo</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">)</span>
</span><span id="__span-12-504"><a id="__codelineno-12-504" name="__codelineno-12-504" href="#__codelineno-12-504"></a>
</span><span id="__span-12-505"><a id="__codelineno-12-505" name="__codelineno-12-505" href="#__codelineno-12-505"></a>        <span class="c1"># Todoリスト</span>
</span><span id="__span-12-506"><a id="__codelineno-12-506" name="__codelineno-12-506" href="#__codelineno-12-506"></a>        <span class="n">list_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">SUNKEN</span><span class="p">,</span> <span class="n">borderwidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-12-507"><a id="__codelineno-12-507" name="__codelineno-12-507" href="#__codelineno-12-507"></a>        <span class="n">list_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-12-508"><a id="__codelineno-12-508" name="__codelineno-12-508" href="#__codelineno-12-508"></a>
</span><span id="__span-12-509"><a id="__codelineno-12-509" name="__codelineno-12-509" href="#__codelineno-12-509"></a>        <span class="c1"># スクロール可能フレーム</span>
</span><span id="__span-12-510"><a id="__codelineno-12-510" name="__codelineno-12-510" href="#__codelineno-12-510"></a>        <span class="n">canvas</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="n">list_frame</span><span class="p">)</span>
</span><span id="__span-12-511"><a id="__codelineno-12-511" name="__codelineno-12-511" href="#__codelineno-12-511"></a>        <span class="n">scrollbar</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="p">(</span><span class="n">list_frame</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="n">canvas</span><span class="o">.</span><span class="n">yview</span><span class="p">)</span>
</span><span id="__span-12-512"><a id="__codelineno-12-512" name="__codelineno-12-512" href="#__codelineno-12-512"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scrollable_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">canvas</span><span class="p">)</span>
</span><span id="__span-12-513"><a id="__codelineno-12-513" name="__codelineno-12-513" href="#__codelineno-12-513"></a>
</span><span id="__span-12-514"><a id="__codelineno-12-514" name="__codelineno-12-514" href="#__codelineno-12-514"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scrollable_frame</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
</span><span id="__span-12-515"><a id="__codelineno-12-515" name="__codelineno-12-515" href="#__codelineno-12-515"></a>            <span class="s2">&quot;&lt;Configure&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">canvas</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">scrollregion</span><span class="o">=</span><span class="n">canvas</span><span class="o">.</span><span class="n">bbox</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">))</span>
</span><span id="__span-12-516"><a id="__codelineno-12-516" name="__codelineno-12-516" href="#__codelineno-12-516"></a>        <span class="p">)</span>
</span><span id="__span-12-517"><a id="__codelineno-12-517" name="__codelineno-12-517" href="#__codelineno-12-517"></a>
</span><span id="__span-12-518"><a id="__codelineno-12-518" name="__codelineno-12-518" href="#__codelineno-12-518"></a>        <span class="n">canvas</span><span class="o">.</span><span class="n">create_window</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scrollable_frame</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s2">&quot;nw&quot;</span><span class="p">)</span>
</span><span id="__span-12-519"><a id="__codelineno-12-519" name="__codelineno-12-519" href="#__codelineno-12-519"></a>        <span class="n">canvas</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">yscrollcommand</span><span class="o">=</span><span class="n">scrollbar</span><span class="o">.</span><span class="n">set</span><span class="p">)</span>
</span><span id="__span-12-520"><a id="__codelineno-12-520" name="__codelineno-12-520" href="#__codelineno-12-520"></a>
</span><span id="__span-12-521"><a id="__codelineno-12-521" name="__codelineno-12-521" href="#__codelineno-12-521"></a>        <span class="n">canvas</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-12-522"><a id="__codelineno-12-522" name="__codelineno-12-522" href="#__codelineno-12-522"></a>        <span class="n">scrollbar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
</span><span id="__span-12-523"><a id="__codelineno-12-523" name="__codelineno-12-523" href="#__codelineno-12-523"></a>
</span><span id="__span-12-524"><a id="__codelineno-12-524" name="__codelineno-12-524" href="#__codelineno-12-524"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">todo_widgets</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-12-525"><a id="__codelineno-12-525" name="__codelineno-12-525" href="#__codelineno-12-525"></a>
</span><span id="__span-12-526"><a id="__codelineno-12-526" name="__codelineno-12-526" href="#__codelineno-12-526"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-527"><a id="__codelineno-12-527" name="__codelineno-12-527" href="#__codelineno-12-527"></a>        <span class="c1"># sub_state_addedとsub_for_refresh使用</span>
</span><span id="__span-12-528"><a id="__codelineno-12-528" name="__codelineno-12-528" href="#__codelineno-12-528"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub_state_added</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_todo_added</span><span class="p">)</span>
</span><span id="__span-12-529"><a id="__codelineno-12-529" name="__codelineno-12-529" href="#__codelineno-12-529"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub_for_refresh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_todo_list</span><span class="p">)</span>
</span><span id="__span-12-530"><a id="__codelineno-12-530" name="__codelineno-12-530" href="#__codelineno-12-530"></a>
</span><span id="__span-12-531"><a id="__codelineno-12-531" name="__codelineno-12-531" href="#__codelineno-12-531"></a>        <span class="c1"># TodoリストのUndo/Redoステータス変化を購読</span>
</span><span id="__span-12-532"><a id="__codelineno-12-532" name="__codelineno-12-532" href="#__codelineno-12-532"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub_undo_status</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_todo_undo_status</span><span class="p">)</span>
</span><span id="__span-12-533"><a id="__codelineno-12-533" name="__codelineno-12-533" href="#__codelineno-12-533"></a>
</span><span id="__span-12-534"><a id="__codelineno-12-534" name="__codelineno-12-534" href="#__codelineno-12-534"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_from_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-535"><a id="__codelineno-12-535" name="__codelineno-12-535" href="#__codelineno-12-535"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_todo_list</span><span class="p">()</span>
</span><span id="__span-12-536"><a id="__codelineno-12-536" name="__codelineno-12-536" href="#__codelineno-12-536"></a>
</span><span id="__span-12-537"><a id="__codelineno-12-537" name="__codelineno-12-537" href="#__codelineno-12-537"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_todo_undo_status</span><span class="p">(</span>
</span><span id="__span-12-538"><a id="__codelineno-12-538" name="__codelineno-12-538" href="#__codelineno-12-538"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">can_undo</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">can_redo</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">undo_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">redo_count</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-12-539"><a id="__codelineno-12-539" name="__codelineno-12-539" href="#__codelineno-12-539"></a>    <span class="p">):</span>
</span><span id="__span-12-540"><a id="__codelineno-12-540" name="__codelineno-12-540" href="#__codelineno-12-540"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;TodoリストのUndo/Redoステータス変化ハンドラー&quot;&quot;&quot;</span>
</span><span id="__span-12-541"><a id="__codelineno-12-541" name="__codelineno-12-541" href="#__codelineno-12-541"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">todo_undo_control</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">can_undo</span><span class="p">,</span> <span class="n">can_redo</span><span class="p">,</span> <span class="n">undo_count</span><span class="p">,</span> <span class="n">redo_count</span><span class="p">)</span>
</span><span id="__span-12-542"><a id="__codelineno-12-542" name="__codelineno-12-542" href="#__codelineno-12-542"></a>
</span><span id="__span-12-543"><a id="__codelineno-12-543" name="__codelineno-12-543" href="#__codelineno-12-543"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">enable_todo_undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-544"><a id="__codelineno-12-544" name="__codelineno-12-544" href="#__codelineno-12-544"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;TodoリストのUndo/Redo機能を有効化&quot;&quot;&quot;</span>
</span><span id="__span-12-545"><a id="__codelineno-12-545" name="__codelineno-12-545" href="#__codelineno-12-545"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_enable_undo_redo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="p">),</span> <span class="n">max_history</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</span><span id="__span-12-546"><a id="__codelineno-12-546" name="__codelineno-12-546" href="#__codelineno-12-546"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_todo_undo_btn</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s2">&quot;disabled&quot;</span><span class="p">)</span>
</span><span id="__span-12-547"><a id="__codelineno-12-547" name="__codelineno-12-547" href="#__codelineno-12-547"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">disable_todo_undo_btn</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">)</span>
</span><span id="__span-12-548"><a id="__codelineno-12-548" name="__codelineno-12-548" href="#__codelineno-12-548"></a>
</span><span id="__span-12-549"><a id="__codelineno-12-549" name="__codelineno-12-549" href="#__codelineno-12-549"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">disable_todo_undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-550"><a id="__codelineno-12-550" name="__codelineno-12-550" href="#__codelineno-12-550"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;TodoリストのUndo/Redo機能を無効化&quot;&quot;&quot;</span>
</span><span id="__span-12-551"><a id="__codelineno-12-551" name="__codelineno-12-551" href="#__codelineno-12-551"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_disable_undo_redo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="p">))</span>
</span><span id="__span-12-552"><a id="__codelineno-12-552" name="__codelineno-12-552" href="#__codelineno-12-552"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_todo_undo_btn</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">)</span>
</span><span id="__span-12-553"><a id="__codelineno-12-553" name="__codelineno-12-553" href="#__codelineno-12-553"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">disable_todo_undo_btn</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s2">&quot;disabled&quot;</span><span class="p">)</span>
</span><span id="__span-12-554"><a id="__codelineno-12-554" name="__codelineno-12-554" href="#__codelineno-12-554"></a>
</span><span id="__span-12-555"><a id="__codelineno-12-555" name="__codelineno-12-555" href="#__codelineno-12-555"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">undo_todos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-556"><a id="__codelineno-12-556" name="__codelineno-12-556" href="#__codelineno-12-556"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;TodoリストをUndo&quot;&quot;&quot;</span>
</span><span id="__span-12-557"><a id="__codelineno-12-557" name="__codelineno-12-557" href="#__codelineno-12-557"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_undo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="p">))</span>
</span><span id="__span-12-558"><a id="__codelineno-12-558" name="__codelineno-12-558" href="#__codelineno-12-558"></a>
</span><span id="__span-12-559"><a id="__codelineno-12-559" name="__codelineno-12-559" href="#__codelineno-12-559"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">redo_todos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-560"><a id="__codelineno-12-560" name="__codelineno-12-560" href="#__codelineno-12-560"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;TodoリストをRedo&quot;&quot;&quot;</span>
</span><span id="__span-12-561"><a id="__codelineno-12-561" name="__codelineno-12-561" href="#__codelineno-12-561"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_redo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="p">))</span>
</span><span id="__span-12-562"><a id="__codelineno-12-562" name="__codelineno-12-562" href="#__codelineno-12-562"></a>
</span><span id="__span-12-563"><a id="__codelineno-12-563" name="__codelineno-12-563" href="#__codelineno-12-563"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_todo_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-564"><a id="__codelineno-12-564" name="__codelineno-12-564" href="#__codelineno-12-564"></a>        <span class="c1"># 既存ウィジェットクリア</span>
</span><span id="__span-12-565"><a id="__codelineno-12-565" name="__codelineno-12-565" href="#__codelineno-12-565"></a>        <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">todo_widgets</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="__span-12-566"><a id="__codelineno-12-566" name="__codelineno-12-566" href="#__codelineno-12-566"></a>            <span class="n">widget</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
</span><span id="__span-12-567"><a id="__codelineno-12-567" name="__codelineno-12-567" href="#__codelineno-12-567"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">todo_widgets</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-12-568"><a id="__codelineno-12-568" name="__codelineno-12-568" href="#__codelineno-12-568"></a>
</span><span id="__span-12-569"><a id="__codelineno-12-569" name="__codelineno-12-569" href="#__codelineno-12-569"></a>        <span class="c1"># 新しいリストを描画</span>
</span><span id="__span-12-570"><a id="__codelineno-12-570" name="__codelineno-12-570" href="#__codelineno-12-570"></a>        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">get_current_state</span><span class="p">()</span>
</span><span id="__span-12-571"><a id="__codelineno-12-571" name="__codelineno-12-571" href="#__codelineno-12-571"></a>        <span class="k">for</span> <span class="n">todo</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="p">:</span>
</span><span id="__span-12-572"><a id="__codelineno-12-572" name="__codelineno-12-572" href="#__codelineno-12-572"></a>            <span class="n">todo_widget</span> <span class="o">=</span> <span class="n">TodoItemView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scrollable_frame</span><span class="p">)</span>
</span><span id="__span-12-573"><a id="__codelineno-12-573" name="__codelineno-12-573" href="#__codelineno-12-573"></a>            <span class="n">todo_widget</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-12-574"><a id="__codelineno-12-574" name="__codelineno-12-574" href="#__codelineno-12-574"></a>            <span class="n">todo_widget</span><span class="o">.</span><span class="n">update_data</span><span class="p">(</span><span class="n">todo</span><span class="p">)</span>
</span><span id="__span-12-575"><a id="__codelineno-12-575" name="__codelineno-12-575" href="#__codelineno-12-575"></a>
</span><span id="__span-12-576"><a id="__codelineno-12-576" name="__codelineno-12-576" href="#__codelineno-12-576"></a>            <span class="c1"># イベントハンドラ登録</span>
</span><span id="__span-12-577"><a id="__codelineno-12-577" name="__codelineno-12-577" href="#__codelineno-12-577"></a>            <span class="n">todo_widget</span><span class="o">.</span><span class="n">register_handler</span><span class="p">(</span><span class="s2">&quot;toggle&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_todo</span><span class="p">)</span>
</span><span id="__span-12-578"><a id="__codelineno-12-578" name="__codelineno-12-578" href="#__codelineno-12-578"></a>            <span class="n">todo_widget</span><span class="o">.</span><span class="n">register_handler</span><span class="p">(</span><span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_todo</span><span class="p">)</span>
</span><span id="__span-12-579"><a id="__codelineno-12-579" name="__codelineno-12-579" href="#__codelineno-12-579"></a>
</span><span id="__span-12-580"><a id="__codelineno-12-580" name="__codelineno-12-580" href="#__codelineno-12-580"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">todo_widgets</span><span class="p">[</span><span class="n">todo</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">todo_widget</span>
</span><span id="__span-12-581"><a id="__codelineno-12-581" name="__codelineno-12-581" href="#__codelineno-12-581"></a>
</span><span id="__span-12-582"><a id="__codelineno-12-582" name="__codelineno-12-582" href="#__codelineno-12-582"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_todo_added</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">TodoItem</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-12-583"><a id="__codelineno-12-583" name="__codelineno-12-583" href="#__codelineno-12-583"></a>        <span class="c1"># 新規追加時は全体再描画</span>
</span><span id="__span-12-584"><a id="__codelineno-12-584" name="__codelineno-12-584" href="#__codelineno-12-584"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_todo_list</span><span class="p">()</span>
</span><span id="__span-12-585"><a id="__codelineno-12-585" name="__codelineno-12-585" href="#__codelineno-12-585"></a>
</span><span id="__span-12-586"><a id="__codelineno-12-586" name="__codelineno-12-586" href="#__codelineno-12-586"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_todo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-587"><a id="__codelineno-12-587" name="__codelineno-12-587" href="#__codelineno-12-587"></a>        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="__span-12-588"><a id="__codelineno-12-588" name="__codelineno-12-588" href="#__codelineno-12-588"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span>
</span><span id="__span-12-589"><a id="__codelineno-12-589" name="__codelineno-12-589" href="#__codelineno-12-589"></a>            <span class="k">return</span>
</span><span id="__span-12-590"><a id="__codelineno-12-590" name="__codelineno-12-590" href="#__codelineno-12-590"></a>
</span><span id="__span-12-591"><a id="__codelineno-12-591" name="__codelineno-12-591" href="#__codelineno-12-591"></a>        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">get_current_state</span><span class="p">()</span>
</span><span id="__span-12-592"><a id="__codelineno-12-592" name="__codelineno-12-592" href="#__codelineno-12-592"></a>        <span class="n">new_todo</span> <span class="o">=</span> <span class="n">TodoItem</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">next_todo_id</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>
</span><span id="__span-12-593"><a id="__codelineno-12-593" name="__codelineno-12-593" href="#__codelineno-12-593"></a>
</span><span id="__span-12-594"><a id="__codelineno-12-594" name="__codelineno-12-594" href="#__codelineno-12-594"></a>        <span class="c1"># pub_add_to_list使用</span>
</span><span id="__span-12-595"><a id="__codelineno-12-595" name="__codelineno-12-595" href="#__codelineno-12-595"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_add_to_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="p">,</span> <span class="n">new_todo</span><span class="p">)</span>
</span><span id="__span-12-596"><a id="__codelineno-12-596" name="__codelineno-12-596" href="#__codelineno-12-596"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">next_todo_id</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">next_todo_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-12-597"><a id="__codelineno-12-597" name="__codelineno-12-597" href="#__codelineno-12-597"></a>
</span><span id="__span-12-598"><a id="__codelineno-12-598" name="__codelineno-12-598" href="#__codelineno-12-598"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">entry</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
</span><span id="__span-12-599"><a id="__codelineno-12-599" name="__codelineno-12-599" href="#__codelineno-12-599"></a>
</span><span id="__span-12-600"><a id="__codelineno-12-600" name="__codelineno-12-600" href="#__codelineno-12-600"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">toggle_todo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">todo_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-12-601"><a id="__codelineno-12-601" name="__codelineno-12-601" href="#__codelineno-12-601"></a>        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">get_current_state</span><span class="p">()</span>
</span><span id="__span-12-602"><a id="__codelineno-12-602" name="__codelineno-12-602" href="#__codelineno-12-602"></a>        <span class="n">updated_todos</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-12-603"><a id="__codelineno-12-603" name="__codelineno-12-603" href="#__codelineno-12-603"></a>        <span class="k">for</span> <span class="n">todo</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="p">:</span>
</span><span id="__span-12-604"><a id="__codelineno-12-604" name="__codelineno-12-604" href="#__codelineno-12-604"></a>            <span class="k">if</span> <span class="n">todo</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">todo_id</span><span class="p">:</span>
</span><span id="__span-12-605"><a id="__codelineno-12-605" name="__codelineno-12-605" href="#__codelineno-12-605"></a>                <span class="n">updated</span> <span class="o">=</span> <span class="n">todo</span><span class="o">.</span><span class="n">model_copy</span><span class="p">()</span>
</span><span id="__span-12-606"><a id="__codelineno-12-606" name="__codelineno-12-606" href="#__codelineno-12-606"></a>                <span class="n">updated</span><span class="o">.</span><span class="n">completed</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">updated</span><span class="o">.</span><span class="n">completed</span>
</span><span id="__span-12-607"><a id="__codelineno-12-607" name="__codelineno-12-607" href="#__codelineno-12-607"></a>                <span class="n">updated_todos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">updated</span><span class="p">)</span>
</span><span id="__span-12-608"><a id="__codelineno-12-608" name="__codelineno-12-608" href="#__codelineno-12-608"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-12-609"><a id="__codelineno-12-609" name="__codelineno-12-609" href="#__codelineno-12-609"></a>                <span class="n">updated_todos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">todo</span><span class="p">)</span>
</span><span id="__span-12-610"><a id="__codelineno-12-610" name="__codelineno-12-610" href="#__codelineno-12-610"></a>
</span><span id="__span-12-611"><a id="__codelineno-12-611" name="__codelineno-12-611" href="#__codelineno-12-611"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="p">,</span> <span class="n">updated_todos</span><span class="p">)</span>
</span><span id="__span-12-612"><a id="__codelineno-12-612" name="__codelineno-12-612" href="#__codelineno-12-612"></a>
</span><span id="__span-12-613"><a id="__codelineno-12-613" name="__codelineno-12-613" href="#__codelineno-12-613"></a>    <span class="nd">@make_async_task</span>
</span><span id="__span-12-614"><a id="__codelineno-12-614" name="__codelineno-12-614" href="#__codelineno-12-614"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_todo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">todo_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-12-615"><a id="__codelineno-12-615" name="__codelineno-12-615" href="#__codelineno-12-615"></a>        <span class="k">if</span> <span class="n">messagebox</span><span class="o">.</span><span class="n">askyesno</span><span class="p">(</span><span class="s2">&quot;確認&quot;</span><span class="p">,</span> <span class="s2">&quot;このTodoを削除しますか？&quot;</span><span class="p">):</span>
</span><span id="__span-12-616"><a id="__codelineno-12-616" name="__codelineno-12-616" href="#__codelineno-12-616"></a>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>  <span class="c1"># 削除処理シミュレート</span>
</span><span id="__span-12-617"><a id="__codelineno-12-617" name="__codelineno-12-617" href="#__codelineno-12-617"></a>            <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">get_current_state</span><span class="p">()</span>
</span><span id="__span-12-618"><a id="__codelineno-12-618" name="__codelineno-12-618" href="#__codelineno-12-618"></a>            <span class="n">updated_todos</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">todos</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">todo_id</span><span class="p">]</span>
</span><span id="__span-12-619"><a id="__codelineno-12-619" name="__codelineno-12-619" href="#__codelineno-12-619"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pub_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="p">,</span> <span class="n">updated_todos</span><span class="p">)</span>
</span><span id="__span-12-620"><a id="__codelineno-12-620" name="__codelineno-12-620" href="#__codelineno-12-620"></a>
</span><span id="__span-12-621"><a id="__codelineno-12-621" name="__codelineno-12-621" href="#__codelineno-12-621"></a>
</span><span id="__span-12-622"><a id="__codelineno-12-622" name="__codelineno-12-622" href="#__codelineno-12-622"></a><span class="k">class</span><span class="w"> </span><span class="nc">SidebarContainer</span><span class="p">(</span><span class="n">ContainerComponentTk</span><span class="p">[</span><span class="n">AppState</span><span class="p">]):</span>
</span><span id="__span-12-623"><a id="__codelineno-12-623" name="__codelineno-12-623" href="#__codelineno-12-623"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-624"><a id="__codelineno-12-624" name="__codelineno-12-624" href="#__codelineno-12-624"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">)</span>
</span><span id="__span-12-625"><a id="__codelineno-12-625" name="__codelineno-12-625" href="#__codelineno-12-625"></a>
</span><span id="__span-12-626"><a id="__codelineno-12-626" name="__codelineno-12-626" href="#__codelineno-12-626"></a>        <span class="c1"># 統計表示（Presentationalコンポーネント使用）</span>
</span><span id="__span-12-627"><a id="__codelineno-12-627" name="__codelineno-12-627" href="#__codelineno-12-627"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats_view</span> <span class="o">=</span> <span class="n">StatsView</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-12-628"><a id="__codelineno-12-628" name="__codelineno-12-628" href="#__codelineno-12-628"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats_view</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-12-629"><a id="__codelineno-12-629" name="__codelineno-12-629" href="#__codelineno-12-629"></a>
</span><span id="__span-12-630"><a id="__codelineno-12-630" name="__codelineno-12-630" href="#__codelineno-12-630"></a>        <span class="c1"># 操作ボタン</span>
</span><span id="__span-12-631"><a id="__codelineno-12-631" name="__codelineno-12-631" href="#__codelineno-12-631"></a>        <span class="n">btn_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">)</span>
</span><span id="__span-12-632"><a id="__codelineno-12-632" name="__codelineno-12-632" href="#__codelineno-12-632"></a>        <span class="n">btn_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-12-633"><a id="__codelineno-12-633" name="__codelineno-12-633" href="#__codelineno-12-633"></a>
</span><span id="__span-12-634"><a id="__codelineno-12-634" name="__codelineno-12-634" href="#__codelineno-12-634"></a>        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">btn_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;全ウィンドウ閉じる&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">close_all</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
</span><span id="__span-12-635"><a id="__codelineno-12-635" name="__codelineno-12-635" href="#__codelineno-12-635"></a>            <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">2</span>
</span><span id="__span-12-636"><a id="__codelineno-12-636" name="__codelineno-12-636" href="#__codelineno-12-636"></a>        <span class="p">)</span>
</span><span id="__span-12-637"><a id="__codelineno-12-637" name="__codelineno-12-637" href="#__codelineno-12-637"></a>        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">btn_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;プロセッサー削除&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_proc</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
</span><span id="__span-12-638"><a id="__codelineno-12-638" name="__codelineno-12-638" href="#__codelineno-12-638"></a>            <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">2</span>
</span><span id="__span-12-639"><a id="__codelineno-12-639" name="__codelineno-12-639" href="#__codelineno-12-639"></a>        <span class="p">)</span>
</span><span id="__span-12-640"><a id="__codelineno-12-640" name="__codelineno-12-640" href="#__codelineno-12-640"></a>
</span><span id="__span-12-641"><a id="__codelineno-12-641" name="__codelineno-12-641" href="#__codelineno-12-641"></a>        <span class="c1"># Undo/Redo情報保持用</span>
</span><span id="__span-12-642"><a id="__codelineno-12-642" name="__codelineno-12-642" href="#__codelineno-12-642"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">counter_undo_status</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-12-643"><a id="__codelineno-12-643" name="__codelineno-12-643" href="#__codelineno-12-643"></a>            <span class="s2">&quot;can_undo&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-12-644"><a id="__codelineno-12-644" name="__codelineno-12-644" href="#__codelineno-12-644"></a>            <span class="s2">&quot;can_redo&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-12-645"><a id="__codelineno-12-645" name="__codelineno-12-645" href="#__codelineno-12-645"></a>            <span class="s2">&quot;undo_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-12-646"><a id="__codelineno-12-646" name="__codelineno-12-646" href="#__codelineno-12-646"></a>            <span class="s2">&quot;redo_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-12-647"><a id="__codelineno-12-647" name="__codelineno-12-647" href="#__codelineno-12-647"></a>        <span class="p">}</span>
</span><span id="__span-12-648"><a id="__codelineno-12-648" name="__codelineno-12-648" href="#__codelineno-12-648"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">todos_undo_status</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-12-649"><a id="__codelineno-12-649" name="__codelineno-12-649" href="#__codelineno-12-649"></a>            <span class="s2">&quot;can_undo&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-12-650"><a id="__codelineno-12-650" name="__codelineno-12-650" href="#__codelineno-12-650"></a>            <span class="s2">&quot;can_redo&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-12-651"><a id="__codelineno-12-651" name="__codelineno-12-651" href="#__codelineno-12-651"></a>            <span class="s2">&quot;undo_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-12-652"><a id="__codelineno-12-652" name="__codelineno-12-652" href="#__codelineno-12-652"></a>            <span class="s2">&quot;redo_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-12-653"><a id="__codelineno-12-653" name="__codelineno-12-653" href="#__codelineno-12-653"></a>        <span class="p">}</span>
</span><span id="__span-12-654"><a id="__codelineno-12-654" name="__codelineno-12-654" href="#__codelineno-12-654"></a>
</span><span id="__span-12-655"><a id="__codelineno-12-655" name="__codelineno-12-655" href="#__codelineno-12-655"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-656"><a id="__codelineno-12-656" name="__codelineno-12-656" href="#__codelineno-12-656"></a>        <span class="c1"># 複数の状態変更を監視</span>
</span><span id="__span-12-657"><a id="__codelineno-12-657" name="__codelineno-12-657" href="#__codelineno-12-657"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub_for_refresh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_from_state</span><span class="p">)</span>
</span><span id="__span-12-658"><a id="__codelineno-12-658" name="__codelineno-12-658" href="#__codelineno-12-658"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub_for_refresh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_from_state</span><span class="p">)</span>
</span><span id="__span-12-659"><a id="__codelineno-12-659" name="__codelineno-12-659" href="#__codelineno-12-659"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub_for_refresh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">settings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_from_state</span><span class="p">)</span>
</span><span id="__span-12-660"><a id="__codelineno-12-660" name="__codelineno-12-660" href="#__codelineno-12-660"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub_for_refresh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">total_clicks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_from_state</span><span class="p">)</span>
</span><span id="__span-12-661"><a id="__codelineno-12-661" name="__codelineno-12-661" href="#__codelineno-12-661"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub_for_refresh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_view</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_from_state</span><span class="p">)</span>
</span><span id="__span-12-662"><a id="__codelineno-12-662" name="__codelineno-12-662" href="#__codelineno-12-662"></a>
</span><span id="__span-12-663"><a id="__codelineno-12-663" name="__codelineno-12-663" href="#__codelineno-12-663"></a>        <span class="c1"># sub_dict_item_added使用</span>
</span><span id="__span-12-664"><a id="__codelineno-12-664" name="__codelineno-12-664" href="#__codelineno-12-664"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub_dict_item_added</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">settings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_setting_added</span><span class="p">)</span>
</span><span id="__span-12-665"><a id="__codelineno-12-665" name="__codelineno-12-665" href="#__codelineno-12-665"></a>
</span><span id="__span-12-666"><a id="__codelineno-12-666" name="__codelineno-12-666" href="#__codelineno-12-666"></a>        <span class="c1"># Undo/Redoステータス監視</span>
</span><span id="__span-12-667"><a id="__codelineno-12-667" name="__codelineno-12-667" href="#__codelineno-12-667"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub_undo_status</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_counter_undo_status</span><span class="p">)</span>
</span><span id="__span-12-668"><a id="__codelineno-12-668" name="__codelineno-12-668" href="#__codelineno-12-668"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub_undo_status</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_todos_undo_status</span><span class="p">)</span>
</span><span id="__span-12-669"><a id="__codelineno-12-669" name="__codelineno-12-669" href="#__codelineno-12-669"></a>
</span><span id="__span-12-670"><a id="__codelineno-12-670" name="__codelineno-12-670" href="#__codelineno-12-670"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_counter_undo_status</span><span class="p">(</span>
</span><span id="__span-12-671"><a id="__codelineno-12-671" name="__codelineno-12-671" href="#__codelineno-12-671"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">can_undo</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">can_redo</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">undo_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">redo_count</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-12-672"><a id="__codelineno-12-672" name="__codelineno-12-672" href="#__codelineno-12-672"></a>    <span class="p">):</span>
</span><span id="__span-12-673"><a id="__codelineno-12-673" name="__codelineno-12-673" href="#__codelineno-12-673"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;カウンターのUndo/Redoステータス変化ハンドラー&quot;&quot;&quot;</span>
</span><span id="__span-12-674"><a id="__codelineno-12-674" name="__codelineno-12-674" href="#__codelineno-12-674"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">counter_undo_status</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-12-675"><a id="__codelineno-12-675" name="__codelineno-12-675" href="#__codelineno-12-675"></a>            <span class="s2">&quot;can_undo&quot;</span><span class="p">:</span> <span class="n">can_undo</span><span class="p">,</span>
</span><span id="__span-12-676"><a id="__codelineno-12-676" name="__codelineno-12-676" href="#__codelineno-12-676"></a>            <span class="s2">&quot;can_redo&quot;</span><span class="p">:</span> <span class="n">can_redo</span><span class="p">,</span>
</span><span id="__span-12-677"><a id="__codelineno-12-677" name="__codelineno-12-677" href="#__codelineno-12-677"></a>            <span class="s2">&quot;undo_count&quot;</span><span class="p">:</span> <span class="n">undo_count</span><span class="p">,</span>
</span><span id="__span-12-678"><a id="__codelineno-12-678" name="__codelineno-12-678" href="#__codelineno-12-678"></a>            <span class="s2">&quot;redo_count&quot;</span><span class="p">:</span> <span class="n">redo_count</span><span class="p">,</span>
</span><span id="__span-12-679"><a id="__codelineno-12-679" name="__codelineno-12-679" href="#__codelineno-12-679"></a>        <span class="p">}</span>
</span><span id="__span-12-680"><a id="__codelineno-12-680" name="__codelineno-12-680" href="#__codelineno-12-680"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_from_state</span><span class="p">()</span>
</span><span id="__span-12-681"><a id="__codelineno-12-681" name="__codelineno-12-681" href="#__codelineno-12-681"></a>
</span><span id="__span-12-682"><a id="__codelineno-12-682" name="__codelineno-12-682" href="#__codelineno-12-682"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_todos_undo_status</span><span class="p">(</span>
</span><span id="__span-12-683"><a id="__codelineno-12-683" name="__codelineno-12-683" href="#__codelineno-12-683"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">can_undo</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">can_redo</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">undo_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">redo_count</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-12-684"><a id="__codelineno-12-684" name="__codelineno-12-684" href="#__codelineno-12-684"></a>    <span class="p">):</span>
</span><span id="__span-12-685"><a id="__codelineno-12-685" name="__codelineno-12-685" href="#__codelineno-12-685"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;TodoリストのUndo/Redoステータス変化ハンドラー&quot;&quot;&quot;</span>
</span><span id="__span-12-686"><a id="__codelineno-12-686" name="__codelineno-12-686" href="#__codelineno-12-686"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">todos_undo_status</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-12-687"><a id="__codelineno-12-687" name="__codelineno-12-687" href="#__codelineno-12-687"></a>            <span class="s2">&quot;can_undo&quot;</span><span class="p">:</span> <span class="n">can_undo</span><span class="p">,</span>
</span><span id="__span-12-688"><a id="__codelineno-12-688" name="__codelineno-12-688" href="#__codelineno-12-688"></a>            <span class="s2">&quot;can_redo&quot;</span><span class="p">:</span> <span class="n">can_redo</span><span class="p">,</span>
</span><span id="__span-12-689"><a id="__codelineno-12-689" name="__codelineno-12-689" href="#__codelineno-12-689"></a>            <span class="s2">&quot;undo_count&quot;</span><span class="p">:</span> <span class="n">undo_count</span><span class="p">,</span>
</span><span id="__span-12-690"><a id="__codelineno-12-690" name="__codelineno-12-690" href="#__codelineno-12-690"></a>            <span class="s2">&quot;redo_count&quot;</span><span class="p">:</span> <span class="n">redo_count</span><span class="p">,</span>
</span><span id="__span-12-691"><a id="__codelineno-12-691" name="__codelineno-12-691" href="#__codelineno-12-691"></a>        <span class="p">}</span>
</span><span id="__span-12-692"><a id="__codelineno-12-692" name="__codelineno-12-692" href="#__codelineno-12-692"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_from_state</span><span class="p">()</span>
</span><span id="__span-12-693"><a id="__codelineno-12-693" name="__codelineno-12-693" href="#__codelineno-12-693"></a>
</span><span id="__span-12-694"><a id="__codelineno-12-694" name="__codelineno-12-694" href="#__codelineno-12-694"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_from_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-695"><a id="__codelineno-12-695" name="__codelineno-12-695" href="#__codelineno-12-695"></a>        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">get_current_state</span><span class="p">()</span>
</span><span id="__span-12-696"><a id="__codelineno-12-696" name="__codelineno-12-696" href="#__codelineno-12-696"></a>        <span class="c1"># Containerで状態から必要な値を抽出してPresentationalに渡す</span>
</span><span id="__span-12-697"><a id="__codelineno-12-697" name="__codelineno-12-697" href="#__codelineno-12-697"></a>        <span class="n">completed_todos</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">todos</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">completed</span><span class="p">)</span>
</span><span id="__span-12-698"><a id="__codelineno-12-698" name="__codelineno-12-698" href="#__codelineno-12-698"></a>        <span class="n">total_todos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="p">)</span>
</span><span id="__span-12-699"><a id="__codelineno-12-699" name="__codelineno-12-699" href="#__codelineno-12-699"></a>
</span><span id="__span-12-700"><a id="__codelineno-12-700" name="__codelineno-12-700" href="#__codelineno-12-700"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats_view</span><span class="o">.</span><span class="n">update_stats</span><span class="p">(</span>
</span><span id="__span-12-701"><a id="__codelineno-12-701" name="__codelineno-12-701" href="#__codelineno-12-701"></a>            <span class="n">counter</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="p">,</span>
</span><span id="__span-12-702"><a id="__codelineno-12-702" name="__codelineno-12-702" href="#__codelineno-12-702"></a>            <span class="n">total_clicks</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">total_clicks</span><span class="p">,</span>
</span><span id="__span-12-703"><a id="__codelineno-12-703" name="__codelineno-12-703" href="#__codelineno-12-703"></a>            <span class="n">total_todos</span><span class="o">=</span><span class="n">total_todos</span><span class="p">,</span>
</span><span id="__span-12-704"><a id="__codelineno-12-704" name="__codelineno-12-704" href="#__codelineno-12-704"></a>            <span class="n">completed_todos</span><span class="o">=</span><span class="n">completed_todos</span><span class="p">,</span>
</span><span id="__span-12-705"><a id="__codelineno-12-705" name="__codelineno-12-705" href="#__codelineno-12-705"></a>            <span class="n">settings_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">settings</span><span class="p">),</span>
</span><span id="__span-12-706"><a id="__codelineno-12-706" name="__codelineno-12-706" href="#__codelineno-12-706"></a>            <span class="n">current_view</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">current_view</span><span class="p">,</span>
</span><span id="__span-12-707"><a id="__codelineno-12-707" name="__codelineno-12-707" href="#__codelineno-12-707"></a>            <span class="n">counter_undo_status</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">counter_undo_status</span><span class="p">,</span>
</span><span id="__span-12-708"><a id="__codelineno-12-708" name="__codelineno-12-708" href="#__codelineno-12-708"></a>            <span class="n">todos_undo_status</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">todos_undo_status</span><span class="p">,</span>
</span><span id="__span-12-709"><a id="__codelineno-12-709" name="__codelineno-12-709" href="#__codelineno-12-709"></a>        <span class="p">)</span>
</span><span id="__span-12-710"><a id="__codelineno-12-710" name="__codelineno-12-710" href="#__codelineno-12-710"></a>
</span><span id="__span-12-711"><a id="__codelineno-12-711" name="__codelineno-12-711" href="#__codelineno-12-711"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_setting_added</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-12-712"><a id="__codelineno-12-712" name="__codelineno-12-712" href="#__codelineno-12-712"></a>        <span class="n">messagebox</span><span class="o">.</span><span class="n">showinfo</span><span class="p">(</span><span class="s2">&quot;設定追加&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;設定追加: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-12-713"><a id="__codelineno-12-713" name="__codelineno-12-713" href="#__codelineno-12-713"></a>
</span><span id="__span-12-714"><a id="__codelineno-12-714" name="__codelineno-12-714" href="#__codelineno-12-714"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-715"><a id="__codelineno-12-715" name="__codelineno-12-715" href="#__codelineno-12-715"></a>        <span class="c1"># pub_close_all_subwindows使用</span>
</span><span id="__span-12-716"><a id="__codelineno-12-716" name="__codelineno-12-716" href="#__codelineno-12-716"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_close_all_subwindows</span><span class="p">()</span>
</span><span id="__span-12-717"><a id="__codelineno-12-717" name="__codelineno-12-717" href="#__codelineno-12-717"></a>
</span><span id="__span-12-718"><a id="__codelineno-12-718" name="__codelineno-12-718" href="#__codelineno-12-718"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_proc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-719"><a id="__codelineno-12-719" name="__codelineno-12-719" href="#__codelineno-12-719"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-12-720"><a id="__codelineno-12-720" name="__codelineno-12-720" href="#__codelineno-12-720"></a>            <span class="c1"># pub_delete_processor使用</span>
</span><span id="__span-12-721"><a id="__codelineno-12-721" name="__codelineno-12-721" href="#__codelineno-12-721"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pub_delete_processor</span><span class="p">(</span><span class="s2">&quot;dummy&quot;</span><span class="p">)</span>
</span><span id="__span-12-722"><a id="__codelineno-12-722" name="__codelineno-12-722" href="#__codelineno-12-722"></a>            <span class="n">messagebox</span><span class="o">.</span><span class="n">showinfo</span><span class="p">(</span><span class="s2">&quot;成功&quot;</span><span class="p">,</span> <span class="s2">&quot;プロセッサーを削除しました&quot;</span><span class="p">)</span>
</span><span id="__span-12-723"><a id="__codelineno-12-723" name="__codelineno-12-723" href="#__codelineno-12-723"></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="__span-12-724"><a id="__codelineno-12-724" name="__codelineno-12-724" href="#__codelineno-12-724"></a>            <span class="n">messagebox</span><span class="o">.</span><span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;エラー&quot;</span><span class="p">,</span> <span class="s2">&quot;プロセッサーが見つかりません&quot;</span><span class="p">)</span>
</span><span id="__span-12-725"><a id="__codelineno-12-725" name="__codelineno-12-725" href="#__codelineno-12-725"></a>
</span><span id="__span-12-726"><a id="__codelineno-12-726" name="__codelineno-12-726" href="#__codelineno-12-726"></a>
</span><span id="__span-12-727"><a id="__codelineno-12-727" name="__codelineno-12-727" href="#__codelineno-12-727"></a><span class="c1"># =============================================================================</span>
</span><span id="__span-12-728"><a id="__codelineno-12-728" name="__codelineno-12-728" href="#__codelineno-12-728"></a><span class="c1"># サブウィンドウ</span>
</span><span id="__span-12-729"><a id="__codelineno-12-729" name="__codelineno-12-729" href="#__codelineno-12-729"></a><span class="c1"># =============================================================================</span>
</span><span id="__span-12-730"><a id="__codelineno-12-730" name="__codelineno-12-730" href="#__codelineno-12-730"></a>
</span><span id="__span-12-731"><a id="__codelineno-12-731" name="__codelineno-12-731" href="#__codelineno-12-731"></a>
</span><span id="__span-12-732"><a id="__codelineno-12-732" name="__codelineno-12-732" href="#__codelineno-12-732"></a><span class="k">class</span><span class="w"> </span><span class="nc">SubWindow</span><span class="p">(</span><span class="n">ContainerComponentTk</span><span class="p">[</span><span class="n">AppState</span><span class="p">]):</span>
</span><span id="__span-12-733"><a id="__codelineno-12-733" name="__codelineno-12-733" href="#__codelineno-12-733"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-734"><a id="__codelineno-12-734" name="__codelineno-12-734" href="#__codelineno-12-734"></a>        <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;🔢 サブウィンドウ&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-12-735"><a id="__codelineno-12-735" name="__codelineno-12-735" href="#__codelineno-12-735"></a>
</span><span id="__span-12-736"><a id="__codelineno-12-736" name="__codelineno-12-736" href="#__codelineno-12-736"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">value_label</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
</span><span id="__span-12-737"><a id="__codelineno-12-737" name="__codelineno-12-737" href="#__codelineno-12-737"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">value_label</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-12-738"><a id="__codelineno-12-738" name="__codelineno-12-738" href="#__codelineno-12-738"></a>
</span><span id="__span-12-739"><a id="__codelineno-12-739" name="__codelineno-12-739" href="#__codelineno-12-739"></a>        <span class="n">btn_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-12-740"><a id="__codelineno-12-740" name="__codelineno-12-740" href="#__codelineno-12-740"></a>        <span class="n">btn_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-12-741"><a id="__codelineno-12-741" name="__codelineno-12-741" href="#__codelineno-12-741"></a>
</span><span id="__span-12-742"><a id="__codelineno-12-742" name="__codelineno-12-742" href="#__codelineno-12-742"></a>        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">btn_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;+1&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">increment</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
</span><span id="__span-12-743"><a id="__codelineno-12-743" name="__codelineno-12-743" href="#__codelineno-12-743"></a>            <span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span>
</span><span id="__span-12-744"><a id="__codelineno-12-744" name="__codelineno-12-744" href="#__codelineno-12-744"></a>        <span class="p">)</span>
</span><span id="__span-12-745"><a id="__codelineno-12-745" name="__codelineno-12-745" href="#__codelineno-12-745"></a>        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">btn_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;+5&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_value</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
</span><span id="__span-12-746"><a id="__codelineno-12-746" name="__codelineno-12-746" href="#__codelineno-12-746"></a>            <span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span>
</span><span id="__span-12-747"><a id="__codelineno-12-747" name="__codelineno-12-747" href="#__codelineno-12-747"></a>        <span class="p">)</span>
</span><span id="__span-12-748"><a id="__codelineno-12-748" name="__codelineno-12-748" href="#__codelineno-12-748"></a>
</span><span id="__span-12-749"><a id="__codelineno-12-749" name="__codelineno-12-749" href="#__codelineno-12-749"></a>        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;閉じる&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">close_window</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-12-750"><a id="__codelineno-12-750" name="__codelineno-12-750" href="#__codelineno-12-750"></a>
</span><span id="__span-12-751"><a id="__codelineno-12-751" name="__codelineno-12-751" href="#__codelineno-12-751"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-752"><a id="__codelineno-12-752" name="__codelineno-12-752" href="#__codelineno-12-752"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub_state_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_counter_changed</span><span class="p">)</span>
</span><span id="__span-12-753"><a id="__codelineno-12-753" name="__codelineno-12-753" href="#__codelineno-12-753"></a>
</span><span id="__span-12-754"><a id="__codelineno-12-754" name="__codelineno-12-754" href="#__codelineno-12-754"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_from_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-755"><a id="__codelineno-12-755" name="__codelineno-12-755" href="#__codelineno-12-755"></a>        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">get_current_state</span><span class="p">()</span>
</span><span id="__span-12-756"><a id="__codelineno-12-756" name="__codelineno-12-756" href="#__codelineno-12-756"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">value_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="p">))</span>
</span><span id="__span-12-757"><a id="__codelineno-12-757" name="__codelineno-12-757" href="#__codelineno-12-757"></a>
</span><span id="__span-12-758"><a id="__codelineno-12-758" name="__codelineno-12-758" href="#__codelineno-12-758"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_counter_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_value</span><span class="p">,</span> <span class="n">new_value</span><span class="p">):</span>
</span><span id="__span-12-759"><a id="__codelineno-12-759" name="__codelineno-12-759" href="#__codelineno-12-759"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">value_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">new_value</span><span class="p">))</span>
</span><span id="__span-12-760"><a id="__codelineno-12-760" name="__codelineno-12-760" href="#__codelineno-12-760"></a>
</span><span id="__span-12-761"><a id="__codelineno-12-761" name="__codelineno-12-761" href="#__codelineno-12-761"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">increment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-762"><a id="__codelineno-12-762" name="__codelineno-12-762" href="#__codelineno-12-762"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">AppTopic</span><span class="o">.</span><span class="n">INCREMENT</span><span class="p">)</span>
</span><span id="__span-12-763"><a id="__codelineno-12-763" name="__codelineno-12-763" href="#__codelineno-12-763"></a>
</span><span id="__span-12-764"><a id="__codelineno-12-764" name="__codelineno-12-764" href="#__codelineno-12-764"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-12-765"><a id="__codelineno-12-765" name="__codelineno-12-765" href="#__codelineno-12-765"></a>        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">get_current_state</span><span class="p">()</span>
</span><span id="__span-12-766"><a id="__codelineno-12-766" name="__codelineno-12-766" href="#__codelineno-12-766"></a>        <span class="n">new_value</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">counter</span> <span class="o">+</span> <span class="n">value</span>
</span><span id="__span-12-767"><a id="__codelineno-12-767" name="__codelineno-12-767" href="#__codelineno-12-767"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="p">,</span> <span class="n">new_value</span><span class="p">)</span>
</span><span id="__span-12-768"><a id="__codelineno-12-768" name="__codelineno-12-768" href="#__codelineno-12-768"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">total_clicks</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">total_clicks</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-12-769"><a id="__codelineno-12-769" name="__codelineno-12-769" href="#__codelineno-12-769"></a>
</span><span id="__span-12-770"><a id="__codelineno-12-770" name="__codelineno-12-770" href="#__codelineno-12-770"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close_window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-771"><a id="__codelineno-12-771" name="__codelineno-12-771" href="#__codelineno-12-771"></a>        <span class="c1"># pub_close_subwindow使用</span>
</span><span id="__span-12-772"><a id="__codelineno-12-772" name="__codelineno-12-772" href="#__codelineno-12-772"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_close_subwindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;win_id&quot;</span><span class="p">])</span>
</span><span id="__span-12-773"><a id="__codelineno-12-773" name="__codelineno-12-773" href="#__codelineno-12-773"></a>
</span><span id="__span-12-774"><a id="__codelineno-12-774" name="__codelineno-12-774" href="#__codelineno-12-774"></a>
</span><span id="__span-12-775"><a id="__codelineno-12-775" name="__codelineno-12-775" href="#__codelineno-12-775"></a><span class="c1"># =============================================================================</span>
</span><span id="__span-12-776"><a id="__codelineno-12-776" name="__codelineno-12-776" href="#__codelineno-12-776"></a><span class="c1"># プロセッサー</span>
</span><span id="__span-12-777"><a id="__codelineno-12-777" name="__codelineno-12-777" href="#__codelineno-12-777"></a><span class="c1"># =============================================================================</span>
</span><span id="__span-12-778"><a id="__codelineno-12-778" name="__codelineno-12-778" href="#__codelineno-12-778"></a>
</span><span id="__span-12-779"><a id="__codelineno-12-779" name="__codelineno-12-779" href="#__codelineno-12-779"></a>
</span><span id="__span-12-780"><a id="__codelineno-12-780" name="__codelineno-12-780" href="#__codelineno-12-780"></a><span class="k">class</span><span class="w"> </span><span class="nc">MainProcessor</span><span class="p">(</span><span class="n">ProcessorBase</span><span class="p">[</span><span class="n">AppState</span><span class="p">]):</span>
</span><span id="__span-12-781"><a id="__codelineno-12-781" name="__codelineno-12-781" href="#__codelineno-12-781"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-782"><a id="__codelineno-12-782" name="__codelineno-12-782" href="#__codelineno-12-782"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">AppTopic</span><span class="o">.</span><span class="n">INCREMENT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_increment</span><span class="p">)</span>
</span><span id="__span-12-783"><a id="__codelineno-12-783" name="__codelineno-12-783" href="#__codelineno-12-783"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">AppTopic</span><span class="o">.</span><span class="n">RESET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_reset</span><span class="p">)</span>
</span><span id="__span-12-784"><a id="__codelineno-12-784" name="__codelineno-12-784" href="#__codelineno-12-784"></a>
</span><span id="__span-12-785"><a id="__codelineno-12-785" name="__codelineno-12-785" href="#__codelineno-12-785"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">handle_increment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-786"><a id="__codelineno-12-786" name="__codelineno-12-786" href="#__codelineno-12-786"></a>        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">get_current_state</span><span class="p">()</span>
</span><span id="__span-12-787"><a id="__codelineno-12-787" name="__codelineno-12-787" href="#__codelineno-12-787"></a>        <span class="n">new_counter</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="__span-12-788"><a id="__codelineno-12-788" name="__codelineno-12-788" href="#__codelineno-12-788"></a>        <span class="n">new_total</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">total_clicks</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="__span-12-789"><a id="__codelineno-12-789" name="__codelineno-12-789" href="#__codelineno-12-789"></a>
</span><span id="__span-12-790"><a id="__codelineno-12-790" name="__codelineno-12-790" href="#__codelineno-12-790"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="p">,</span> <span class="n">new_counter</span><span class="p">)</span>
</span><span id="__span-12-791"><a id="__codelineno-12-791" name="__codelineno-12-791" href="#__codelineno-12-791"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">total_clicks</span><span class="p">,</span> <span class="n">new_total</span><span class="p">)</span>
</span><span id="__span-12-792"><a id="__codelineno-12-792" name="__codelineno-12-792" href="#__codelineno-12-792"></a>
</span><span id="__span-12-793"><a id="__codelineno-12-793" name="__codelineno-12-793" href="#__codelineno-12-793"></a>        <span class="c1"># マイルストーン判定</span>
</span><span id="__span-12-794"><a id="__codelineno-12-794" name="__codelineno-12-794" href="#__codelineno-12-794"></a>        <span class="k">if</span> <span class="n">new_counter</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-12-795"><a id="__codelineno-12-795" name="__codelineno-12-795" href="#__codelineno-12-795"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">AppTopic</span><span class="o">.</span><span class="n">MILESTONE</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">new_counter</span><span class="p">)</span>
</span><span id="__span-12-796"><a id="__codelineno-12-796" name="__codelineno-12-796" href="#__codelineno-12-796"></a>
</span><span id="__span-12-797"><a id="__codelineno-12-797" name="__codelineno-12-797" href="#__codelineno-12-797"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">handle_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-798"><a id="__codelineno-12-798" name="__codelineno-12-798" href="#__codelineno-12-798"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pub_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">counter</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-12-799"><a id="__codelineno-12-799" name="__codelineno-12-799" href="#__codelineno-12-799"></a>
</span><span id="__span-12-800"><a id="__codelineno-12-800" name="__codelineno-12-800" href="#__codelineno-12-800"></a>
</span><span id="__span-12-801"><a id="__codelineno-12-801" name="__codelineno-12-801" href="#__codelineno-12-801"></a><span class="k">class</span><span class="w"> </span><span class="nc">DummyProcessor</span><span class="p">(</span><span class="n">ProcessorBase</span><span class="p">[</span><span class="n">AppState</span><span class="p">]):</span>
</span><span id="__span-12-802"><a id="__codelineno-12-802" name="__codelineno-12-802" href="#__codelineno-12-802"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-12-803"><a id="__codelineno-12-803" name="__codelineno-12-803" href="#__codelineno-12-803"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DummyProcessor: 初期化されました&quot;</span><span class="p">)</span>
</span><span id="__span-12-804"><a id="__codelineno-12-804" name="__codelineno-12-804" href="#__codelineno-12-804"></a>
</span><span id="__span-12-805"><a id="__codelineno-12-805" name="__codelineno-12-805" href="#__codelineno-12-805"></a>
</span><span id="__span-12-806"><a id="__codelineno-12-806" name="__codelineno-12-806" href="#__codelineno-12-806"></a><span class="c1"># =============================================================================</span>
</span><span id="__span-12-807"><a id="__codelineno-12-807" name="__codelineno-12-807" href="#__codelineno-12-807"></a><span class="c1"># メインアプリケーション</span>
</span><span id="__span-12-808"><a id="__codelineno-12-808" name="__codelineno-12-808" href="#__codelineno-12-808"></a><span class="c1"># =============================================================================</span>
</span><span id="__span-12-809"><a id="__codelineno-12-809" name="__codelineno-12-809" href="#__codelineno-12-809"></a>
</span><span id="__span-12-810"><a id="__codelineno-12-810" name="__codelineno-12-810" href="#__codelineno-12-810"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-12-811"><a id="__codelineno-12-811" name="__codelineno-12-811" href="#__codelineno-12-811"></a>    <span class="n">app</span> <span class="o">=</span> <span class="n">TkApplication</span><span class="p">(</span><span class="n">AppState</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;🎯 PubSubTk Demo&quot;</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;800x600&quot;</span><span class="p">)</span>
</span><span id="__span-12-812"><a id="__codelineno-12-812" name="__codelineno-12-812" href="#__codelineno-12-812"></a>
</span><span id="__span-12-813"><a id="__codelineno-12-813" name="__codelineno-12-813" href="#__codelineno-12-813"></a>    <span class="c1"># メインプロセッサー登録</span>
</span><span id="__span-12-814"><a id="__codelineno-12-814" name="__codelineno-12-814" href="#__codelineno-12-814"></a>    <span class="n">app</span><span class="o">.</span><span class="n">pub_register_processor</span><span class="p">(</span><span class="n">MainProcessor</span><span class="p">)</span>
</span><span id="__span-12-815"><a id="__codelineno-12-815" name="__codelineno-12-815" href="#__codelineno-12-815"></a>
</span><span id="__span-12-816"><a id="__codelineno-12-816" name="__codelineno-12-816" href="#__codelineno-12-816"></a>    <span class="c1"># テンプレート設定</span>
</span><span id="__span-12-817"><a id="__codelineno-12-817" name="__codelineno-12-817" href="#__codelineno-12-817"></a>    <span class="n">app</span><span class="o">.</span><span class="n">set_template</span><span class="p">(</span><span class="n">AppTemplate</span><span class="p">)</span>
</span><span id="__span-12-818"><a id="__codelineno-12-818" name="__codelineno-12-818" href="#__codelineno-12-818"></a>
</span><span id="__span-12-819"><a id="__codelineno-12-819" name="__codelineno-12-819" href="#__codelineno-12-819"></a>    <span class="c1"># 各スロットにコンテナ配置</span>
</span><span id="__span-12-820"><a id="__codelineno-12-820" name="__codelineno-12-820" href="#__codelineno-12-820"></a>    <span class="n">app</span><span class="o">.</span><span class="n">pub_switch_slot</span><span class="p">(</span><span class="s2">&quot;navbar&quot;</span><span class="p">,</span> <span class="n">NavbarContainer</span><span class="p">)</span>
</span><span id="__span-12-821"><a id="__codelineno-12-821" name="__codelineno-12-821" href="#__codelineno-12-821"></a>    <span class="n">app</span><span class="o">.</span><span class="n">pub_switch_slot</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="n">MainContainer</span><span class="p">)</span>  <span class="c1"># 初期画面</span>
</span><span id="__span-12-822"><a id="__codelineno-12-822" name="__codelineno-12-822" href="#__codelineno-12-822"></a>    <span class="n">app</span><span class="o">.</span><span class="n">pub_switch_slot</span><span class="p">(</span><span class="s2">&quot;sidebar&quot;</span><span class="p">,</span> <span class="n">SidebarContainer</span><span class="p">)</span>
</span><span id="__span-12-823"><a id="__codelineno-12-823" name="__codelineno-12-823" href="#__codelineno-12-823"></a>
</span><span id="__span-12-824"><a id="__codelineno-12-824" name="__codelineno-12-824" href="#__codelineno-12-824"></a>    <span class="c1"># 起動</span>
</span><span id="__span-12-825"><a id="__codelineno-12-825" name="__codelineno-12-825" href="#__codelineno-12-825"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">use_async</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  ページトップへ戻る
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.highlight", "search.share", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f", "clipboard.copy": "\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3078\u30b3\u30d4\u30fc", "search.result.more.one": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3082\u30461\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.more.other": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3042\u3068#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.none": "\u4f55\u3082\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f", "search.result.one": "1\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.other": "#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.placeholder": "\u691c\u7d22\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044", "search.result.term.missing": "\u691c\u7d22\u306b\u542b\u307e\u308c\u306a\u3044", "select.version": "\u30d0\u30fc\u30b8\u30e7\u30f3\u5207\u308a\u66ff\u3048"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
      
    
  </body>
</html>